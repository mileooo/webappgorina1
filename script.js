/* ================== CONFIG ==================
 Replace ADMIN_WEBHOOK_URL with your server endpoint to receive order notifications.
 For Telegram login within WebApp the code tries to use window.Telegram.WebApp.initDataUnsafe
=============================================*/
const ADMIN_WEBHOOK_URL = ""; // <-- PUT YOUR ADMIN WEBHOOK URL HERE (POST)

/* Telegram fallback object (WebApp) */
const tg = window.Telegram && window.Telegram.WebApp ? window.Telegram.WebApp : null;

/* ========== Products (array format) ========== */
const products = [
["üçê –ì—Ä—É—à–∞ ‚Äî 340 ‚ÇΩ/–∫–≥", "–ì—Ä—É—à–∞", 340, "fruits"],
["üçä –ê–ø–µ–ª—å—Å–∏–Ω ‚Äî 220 ‚ÇΩ/–∫–≥", "–ê–ø–µ–ª—å—Å–∏–Ω", 220, "fruits"],
["üçà –î—ã–Ω—è –¢–æ—Ä–ø–µ–¥–∞ –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω ‚Äî 80 ‚ÇΩ/–∫–≥", "–î—ã–Ω—è –¢–æ—Ä–ø–µ–¥–∞ –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω", 80, "fruits"],
["üçà –î—ã–Ω—è –ö–æ–ª—Ö–æ–∑–Ω–∏—Ü–∞ ‚Äî 80 ‚ÇΩ/–∫–≥", "–î—ã–Ω—è –ö–æ–ª—Ö–æ–∑–Ω–∏—Ü–∞", 80, "fruits"],
["üçá –í–∏–Ω–æ–≥—Ä–∞–¥ –∑–µ–ª—ë–Ω—ã–π (–±–µ–∑ –∫–æ—Å—Ç–æ—á–µ–∫) ‚Äî 320 ‚ÇΩ/–∫–≥", "–í–∏–Ω–æ–≥—Ä–∞–¥ –∑–µ–ª—ë–Ω—ã–π", 320, "fruits"],
["üçá –í–∏–Ω–æ–≥—Ä–∞–¥ —Ç—ë–º–Ω—ã–π (–±–µ–∑ –∫–æ—Å—Ç–æ—á–µ–∫) ‚Äî 320 ‚ÇΩ/–∫–≥", "–í–∏–Ω–æ–≥—Ä–∞–¥ —Ç—ë–º–Ω—ã–π", 320, "fruits"],
["üçá –í–∏–Ω–æ–≥—Ä–∞–¥ —á—ë—Ä–Ω—ã–π (–ú–µ—Ä—Å–µ–¥–µ—Å) ‚Äî 300 ‚ÇΩ/–∫–≥", "–í–∏–Ω–æ–≥—Ä–∞–¥ –ú–µ—Ä—Å–µ–¥–µ—Å", 300, "fruits"],
["üçë –ù–µ–∫—Ç–∞—Ä–∏–Ω –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω –∫—Ä–∞—Å–Ω—ã–π ‚Äî 170 ‚ÇΩ/–∫–≥", "–ù–µ–∫—Ç–∞—Ä–∏–Ω –∫—Ä–∞—Å–Ω—ã–π –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω", 170, "fruits"],
["üçë –ù–µ–∫—Ç–∞—Ä–∏–Ω –¢—É—Ä—Ü–∏—è ‚Äî 350 ‚ÇΩ/–∫–≥", "–ù–µ–∫—Ç–∞—Ä–∏–Ω –¢—É—Ä—Ü–∏—è", 350, "fruits"],
["üçë –ù–µ–∫—Ç–∞—Ä–∏–Ω –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω –∂—ë–ª—Ç—ã–π ‚Äî 250 ‚ÇΩ/–∫–≥", "–ù–µ–∫—Ç–∞—Ä–∏–Ω –∂—ë–ª—Ç—ã–π –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω", 250, "fruits"],
["üçë –ù–µ–∫—Ç–∞—Ä–∏–Ω –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω –∑–µ–ª—ë–Ω—ã–π ‚Äî 190 ‚ÇΩ/–∫–≥", "–ù–µ–∫—Ç–∞—Ä–∏–Ω –∑–µ–ª—ë–Ω—ã–π –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω", 190, "fruits"],
["üçå –ë–∞–Ω–∞–Ω ‚Äî 170 ‚ÇΩ/–∫–≥", "–ë–∞–Ω–∞–Ω", 170, "fruits"],
["üçê –ì—Ä—É—à–∞ –ö–∏—Ç–∞–π—Å–∫–∞—è ‚Äî 180 ‚ÇΩ/–∫–≥", "–ì—Ä—É—à–∞ –ö–∏—Ç–∞–π—Å–∫–∞—è", 180, "fruits"],
["üçê –ì—Ä—É—à–∞ –ê–∑–µ—Ä–±–∞–π–¥–∂–∞–Ω ‚Äî 250 ‚ÇΩ/–∫–≥", "–ì—Ä—É—à–∞ –ê–∑–µ—Ä–±–∞–π–¥–∂–∞–Ω", 250, "fruits"],
["üçê –ì—Ä—É—à–∞ –ö–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏—è ‚Äî 290 ‚ÇΩ/–∫–≥", "–ì—Ä—É—à–∞ –ö–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏—è", 290, "fruits"],
["üçê –ì—Ä—É—à–∞ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–∏—è ‚Äî 260 ‚ÇΩ/–∫–≥", "–ì—Ä—É—à–∞ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–∏—è", 260, "fruits"],
["üçé –ì—Ä–∞–Ω–∞—Ç ‚Äî 250 ‚ÇΩ/–∫–≥", "–ì—Ä–∞–Ω–∞—Ç", 250, "fruits"],
["üçä –ú–∞–Ω–¥–∞—Ä–∏–Ω—ã –¢—É—Ä—Ü–∏—è ‚Äî 280 ‚ÇΩ/–∫–≥", "–ú–∞–Ω–¥–∞—Ä–∏–Ω—ã –¢—É—Ä—Ü–∏—è", 280, "fruits"],
["üçè –Ø–±–ª–æ–∫–∏ –ö–∞–±–∞—Ä–¥–∏–Ω—Å–∫–∏–µ ‚Äî 100 ‚ÇΩ/–∫–≥", "–Ø–±–ª–æ–∫–∏ –ö–∞–±–∞—Ä–¥–∏–Ω—Å–∫–∏–µ", 100, "fruits"],
["üçè –Ø–±–ª–æ–∫–∏ –°–∏–±–µ—Ä–∏—è ‚Äî 190 ‚ÇΩ/–∫–≥", "–Ø–±–ª–æ–∫–∏ –°–∏–±–µ—Ä–∏—è", 190, "fruits"],
["üçé –Ø–±–ª–æ–∫–∏ –ß—ë—Ä–Ω—ã–π –ü—Ä–∏–Ω—Ü ‚Äî 240 ‚ÇΩ/–∫–≥", "–Ø–±–ª–æ–∫–∏ –ß—ë—Ä–Ω—ã–π –ü—Ä–∏–Ω—Ü", 240, "fruits"],
["üçí –ß–µ—Ä–µ—à–Ω—è ‚Äî 580 ‚ÇΩ/–∫–≥", "–ß–µ—Ä–µ—à–Ω—è", 580, "fruits"],
["ü´ê –ì–æ–ª—É–±–∏–∫–∞ ‚Äî 800 ‚ÇΩ/–∫–≥", "–ì–æ–ª—É–±–∏–∫–∞", 800, "fruits"],
["üçë –ê–±—Ä–∏–∫–æ—Å –ê—Ä–º–µ–Ω–∏—è ‚Äî 240 ‚ÇΩ/–∫–≥", "–ê–±—Ä–∏–∫–æ—Å –ê—Ä–º–µ–Ω–∏—è", 240, "fruits"],
["üçë –ê–±—Ä–∏–∫–æ—Å –ö–∏—Ä–≥–∏–∑–∏—è ‚Äî 150 ‚ÇΩ/–∫–≥", "–ê–±—Ä–∏–∫–æ—Å –ö–∏—Ä–≥–∏–∑–∏—è", 150, "fruits"],
["üçë –ü–µ—Ä—Å–∏–∫ –¢–∞—à–∫–µ–Ω—Ç ‚Äî 250 ‚ÇΩ/–∫–≥", "–ü–µ—Ä—Å–∏–∫ –¢–∞—à–∫–µ–Ω—Ç", 250, "fruits"],
["üçë –ü–µ—Ä—Å–∏–∫ –ê—Ä–º–µ–Ω–∏—è ‚Äî 380 ‚ÇΩ/–∫–≥", "–ü–µ—Ä—Å–∏–∫ –ê—Ä–º–µ–Ω–∏—è", 380, "fruits"],
["üçë –ü–µ—Ä—Å–∏–∫ –¢—É—Ä—Ü–∏—è ‚Äî 450 ‚ÇΩ/–∫–≥", "–ü–µ—Ä—Å–∏–∫ –¢—É—Ä—Ü–∏—è", 450, "fruits"],
["üçë –ü–µ—Ä—Å–∏–∫ –ò–Ω–∂–∏—Ä–Ω—ã–π ‚Äî 350 ‚ÇΩ/–∫–≥", "–ü–µ—Ä—Å–∏–∫ –ò–Ω–∂–∏—Ä–Ω—ã–π", 350, "fruits"],
["ü•ù –ö–∏–≤–∏ ‚Äî 450 ‚ÇΩ/–∫–≥", "–ö–∏–≤–∏", 450, "fruits"],
["üçã –õ–∏–º–æ–Ω ‚Äî 290 ‚ÇΩ/–∫–≥", "–õ–∏–º–æ–Ω", 290, "fruits"],
["üçÖ –ü–æ–º–∏–¥–æ—Ä—ã –±–æ—á–∫–æ–≤—ã–µ ‚Äî 325 ‚ÇΩ/–∫–≥", "–ü–æ–º–∏–¥–æ—Ä—ã –±–æ—á–∫–æ–≤—ã–µ", 325, "vegetables"],
["ü•í –û–≥—É—Ä—Ü—ã —Å–æ–ª—ë–Ω—ã–µ ‚Äî 250 ‚ÇΩ/–∫–≥", "–û–≥—É—Ä—Ü—ã —Å–æ–ª—ë–Ω—ã–µ", 250, "vegetables"],
["üå± –î–∞–π–∫–æ–Ω ‚Äî 140 ‚ÇΩ/–∫–≥", "–î–∞–π–∫–æ–Ω", 140, "vegetables"],
["ü•¨ –ü–µ–∫–∏–Ω—Å–∫–∞—è –∫–∞–ø—É—Å—Ç–∞ ‚Äî 120 ‚ÇΩ/–∫–≥", "–ü–µ–∫–∏–Ω—Å–∫–∞—è –∫–∞–ø—É—Å—Ç–∞", 120, "vegetables"],
["üçà –ü–æ–º–µ–ª–æ ‚Äî 260 ‚ÇΩ", "–ü–æ–º–µ–ª–æ", 260, "vegetables"],
["ü•ó –°–∞–ª–∞—Ç –ê–π—Å–±–µ—Ä–≥ ‚Äî 270 ‚ÇΩ/–∫–≥", "–°–∞–ª–∞—Ç –ê–π—Å–±–µ—Ä–≥", 270, "vegetables"],
["ü´ö –ò–º–±–∏—Ä—å ‚Äî 450 ‚ÇΩ/–∫–≥", "–ò–º–±–∏—Ä—å", 450, "vegetables"],
["ü•¶ –¶–≤–µ—Ç–Ω–∞—è –∫–∞–ø—É—Å—Ç–∞ ‚Äî 150 ‚ÇΩ/–∫–≥", "–¶–≤–µ—Ç–Ω–∞—è –∫–∞–ø—É—Å—Ç–∞", 150, "vegetables"],
["üçê –ê–π–≤–∞ ‚Äî 220 ‚ÇΩ/–∫–≥", "–ê–π–≤–∞", 220, "vegetables"],
["üçÖ –ü–æ–º–∏–¥–æ—Ä—ã –ê–∑–µ—Ä–±–∞–π–¥–∂–∞–Ω—Å–∫–∏–µ ‚Äî 220 ‚ÇΩ/–∫–≥", "–ü–æ–º–∏–¥–æ—Ä—ã –ê–∑–µ—Ä–±–∞–π–¥–∂–∞–Ω—Å–∫–∏–µ", 220, "vegetables"],
["üçÖ –ü–æ–º–∏–¥–æ—Ä—ã –†–æ—Å—Ç–æ–≤—Å–∫–∏–µ ‚Äî 180 ‚ÇΩ/–∫–≥", "–ü–æ–º–∏–¥–æ—Ä—ã –†–æ—Å—Ç–æ–≤—Å–∫–∏–µ", 180, "vegetables"],
["üçÖ –ü–æ–º–∏–¥–æ—Ä—ã –í–æ–ª–≥–æ–≥—Ä–∞–¥ (–º–µ–ª–∫–∏–µ) ‚Äî 80 ‚ÇΩ/–∫–≥", "–ü–æ–º–∏–¥–æ—Ä—ã –í–æ–ª–≥–æ–≥—Ä–∞–¥", 80, "vegetables"],
["üçÖ –ü–æ–º–∏–¥–æ—Ä—ã –¥–æ–º–∞—à–Ω–∏–µ ‚Äî 240 ‚ÇΩ/–∫–≥", "–ü–æ–º–∏–¥–æ—Ä—ã –¥–æ–º–∞—à–Ω–∏–µ", 240, "vegetables"],
["üçÖ –ü–æ–º–∏–¥–æ—Ä—ã –ê—Å—Ç—Ä–∞—Ö–∞–Ω—å (–∂—ë–ª—Ç—ã–µ) ‚Äî 190 ‚ÇΩ/–∫–≥", "–ü–æ–º–∏–¥–æ—Ä—ã –ê—Å—Ç—Ä–∞—Ö–∞–Ω—å –∂—ë–ª—Ç—ã–µ", 190, "vegetables"],
["ü•í –û–≥—É—Ä—Ü—ã –ú–æ—Å–∫–æ–≤—Å–∫–∏–µ ‚Äî 150 ‚ÇΩ/–∫–≥", "–û–≥—É—Ä—Ü—ã –ú–æ—Å–∫–æ–≤—Å–∫–∏–µ", 150, "vegetables"],
["ü•í –û–≥—É—Ä—Ü—ã –°–∞–º–∞—Ä—Å–∫–∏–µ ‚Äî 80 ‚ÇΩ/–∫–≥", "–û–≥—É—Ä—Ü—ã –°–∞–º–∞—Ä—Å–∫–∏–µ", 80, "vegetables"],
["ü•í –û–≥—É—Ä—Ü—ã –¥–æ–º–∞—à–Ω–∏–µ ‚Äî 150 ‚ÇΩ/–∫–≥", "–û–≥—É—Ä—Ü—ã –¥–æ–º–∞—à–Ω–∏–µ", 150, "vegetables"],
["ü•í –ö–∞–±–∞—á–æ–∫ ‚Äî 55 ‚ÇΩ/–∫–≥", "–ö–∞–±–∞—á–æ–∫", 55, "vegetables"],
["üçÜ –ë–∞–∫–ª–∞–∂–∞–Ω ‚Äî 130 ‚ÇΩ/–∫–≥", "–ë–∞–∫–ª–∞–∂–∞–Ω", 130, "vegetables"],
["üåø –ó–µ–ª–µ–Ω—å ‚Äî 450 ‚ÇΩ/–∫–≥", "–ó–µ–ª–µ–Ω—å", 450, "greens"],
["üå± –õ—É–∫ –∑–µ–ª—ë–Ω—ã–π ‚Äî 350 ‚ÇΩ/–∫–≥", "–õ—É–∫ –∑–µ–ª—ë–Ω—ã–π", 350, "greens"],
["üåø –£–∫—Ä–æ–ø / –ü–µ—Ç—Ä—É—à–∫–∞ ‚Äî 350 ‚ÇΩ/–∫–≥", "–£–∫—Ä–æ–ø –ü–µ—Ç—Ä—É—à–∫–∞", 350, "greens"],
["üåø –ö–∏–Ω–∑–∞ ‚Äî 440 ‚ÇΩ/–∫–≥", "–ö–∏–Ω–∑–∞", 440, "greens"],
["üåø –ë–∞–∑–∏–ª–∏–∫ (–ø—É—á–æ–∫) ‚Äî 50 ‚ÇΩ", "–ë–∞–∑–∏–ª–∏–∫", 50, "greens"],
["üçØ –§–∏–Ω–∏–∫–∏ Zibo ‚Äî 220 ‚ÇΩ", "–§–∏–Ω–∏–∫–∏ Zibo", 220, "nuts"],
["üçí –®–∏–ø–æ–≤–Ω–∏–∫ ‚Äî 85 ‚ÇΩ", "–®–∏–ø–æ–≤–Ω–∏–∫", 85, "nuts"],
["üå∞ –ì—Ä–µ—Ü–∫–∏–π –æ—Ä–µ—Ö ‚Äî 290 ‚ÇΩ/–∫–≥", "–ì—Ä–µ—Ü–∫–∏–π –æ—Ä–µ—Ö", 290, "nuts"],
["üçá –ò–∑—é–º ‚Äî 460 ‚ÇΩ/–∫–≥", "–ò–∑—é–º", 460, "nuts"],
["üå∞ –ì—Ä–µ—Ü–∫–∏–π –æ—Ä–µ—Ö –æ—á–∏—â–µ–Ω–Ω—ã–π ‚Äî 640 ‚ÇΩ/–∫–≥", "–ì—Ä–µ—Ü–∫–∏–π –æ—Ä–µ—Ö –æ—á–∏—â–µ–Ω–Ω—ã–π", 640, "nuts"],
["üçë –ß–µ—Ä–Ω–æ—Å–ª–∏–≤ ‚Äî 370 ‚ÇΩ/–∫–≥", "–ß–µ—Ä–Ω–æ—Å–ª–∏–≤", 370, "nuts"],
["üçë –ö—É—Ä–∞–≥–∞ ‚Äî 430 ‚ÇΩ/–∫–≥", "–ö—É—Ä–∞–≥–∞", 430, "nuts"],
["üçë –°–ª–∏–≤–∞ (4 –≤–∏–¥–∞) ‚Äî 220 ‚ÇΩ/–∫–≥", "–°–ª–∏–≤–∞", 220, "nuts"],
["üç™ –ü—Ä—è–Ω–∏–∫–∏ ‚Äî 248 ‚ÇΩ/–∫–≥", "–ü—Ä—è–Ω–∏–∫–∏ 248", 248, "sweets"],
["üç™ –ü—Ä—è–Ω–∏–∫–∏ ‚Äî 236 ‚ÇΩ/–∫–≥", "–ü—Ä—è–Ω–∏–∫–∏ 236", 236, "sweets"],
["üç™ –ü—Ä—è–Ω–∏–∫–∏ ‚Äî 215 ‚ÇΩ/–∫–≥", "–ü—Ä—è–Ω–∏–∫–∏ 215", 215, "sweets"],
["üç™ –ü—Ä—è–Ω–∏–∫–∏ ‚Äî 209 ‚ÇΩ/–∫–≥", "–ü—Ä—è–Ω–∏–∫–∏ 209", 209, "sweets"],
["üç™ –ü—Ä—è–Ω–∏–∫–∏ ‚Äî 267 ‚ÇΩ/–∫–≥", "–ü—Ä—è–Ω–∏–∫–∏ 267", 267, "sweets"],
["üßá –Ø—à–∫–∏–Ω–æ –í–∞—Ñ–ª–∏ —Å–ª–∏–≤–æ—á–Ω—ã–µ ‚Äî 79 ‚ÇΩ", "–í–∞—Ñ–ª–∏ —Å–ª–∏–≤–æ—á–Ω—ã–µ –Ø—à–∫–∏–Ω–æ", 79, "sweets"],
["üßá –ö–æ—Ä–æ–≤–∫–∞ –í–∞—Ñ–ª–∏ ‚Äî 72 ‚ÇΩ", "–í–∞—Ñ–ª–∏ –ö–æ—Ä–æ–≤–∫–∞", 72, "sweets"],
["üßá –Ø—à–∫–∏–Ω–æ –í–∞—Ñ–ª–∏ –ª–∏–º–æ–Ω-–ª–∞–π–º ‚Äî 116 ‚ÇΩ", "–í–∞—Ñ–ª–∏ –ª–∏–º–æ–Ω-–ª–∞–π–º", 116, "sweets"],
["üç™ –ü–µ—á–µ–Ω—å–µ –ú–∞—Ä–∏—è ‚Äî 103 ‚ÇΩ", "–ü–µ—á–µ–Ω—å–µ –ú–∞—Ä–∏—è", 103, "sweets"],
["üçù –ú–∞–∫–∞—Ä–æ–Ω—ã –ú–ê–†–¢–ò–ù ‚Äî 104 ‚ÇΩ", "–ú–∞–∫–∞—Ä–æ–Ω—ã –ú–ê–†–¢–ò–ù", 104, "pasta"],
["üçù –ú–∞–∫–∞—Ä–æ–Ω—ã –î–û–ë–†–û–î–ï–Ø ‚Äî 161 ‚ÇΩ", "–ú–∞–∫–∞—Ä–æ–Ω—ã –î–û–ë–†–û–î–ï–Ø", 161, "pasta"],
["üçù –ú–∞–∫–∞—Ä–æ–Ω—ã MAKFA ‚Äî 80 ‚ÇΩ", "–ú–∞–∫–∞—Ä–æ–Ω—ã MAKFA", 80, "pasta"],
["ü•´ –®–ø—Ä–æ—Ç—ã ‚Äî 125 ‚ÇΩ", "–®–ø—Ä–æ—Ç—ã", 125, "canned"],
["ü•´ –°–∞—Ä–¥–∏–Ω–∞ ‚Äî 112 ‚ÇΩ", "–°–∞—Ä–¥–∏–Ω–∞ 112", 112, "canned"],
["ü•´ –°–∞—Ä–¥–∏–Ω–∞ ‚Äî 91 ‚ÇΩ", "–°–∞—Ä–¥–∏–Ω–∞ 91", 91, "canned"],
["ü•´ –°–∞—Ä–¥–∏–Ω–µ–ª–ª–∞ ‚Äî 105 ‚ÇΩ", "–°–∞—Ä–¥–∏–Ω–µ–ª–ª–∞", 105, "canned"],
["üçÑ –®–∞–º–ø–∏–Ω—å–æ–Ω—ã —Ä–µ–∑–∞–Ω—ã–µ ‚Äî 97 ‚ÇΩ", "–®–∞–º–ø–∏–Ω—å–æ–Ω—ã —Ä–µ–∑–∞–Ω—ã–µ 97", 97, "canned"],
["üçÑ –®–∞–º–ø–∏–Ω—å–æ–Ω—ã —Ä–µ–∑–∞–Ω—ã–µ ‚Äî 85 ‚ÇΩ", "–®–∞–º–ø–∏–Ω—å–æ–Ω—ã —Ä–µ–∑–∞–Ω—ã–µ 85", 85, "canned"],
["ü´í –û–ª–∏–≤–∫–∏ ‚Äî 130 ‚ÇΩ", "–û–ª–∏–≤–∫–∏", 130, "canned"],
["ü´í –ú–∞—Å–ª–∏–Ω—ã ‚Äî 130 ‚ÇΩ", "–ú–∞—Å–ª–∏–Ω—ã", 130, "canned"],
["ü•í –ö–æ—Ä–Ω–∏—à–æ–Ω—ã —Ö—Ä—É—Å—Ç—è—â–∏–µ ‚Äî 145 ‚ÇΩ", "–ö–æ—Ä–Ω–∏—à–æ–Ω—ã —Ö—Ä—É—Å—Ç—è—â–∏–µ", 145, "canned"],
["üåø –£–∫—Ä–æ–ø —Å—É—à—ë–Ω—ã–π ‚Äî 18 ‚ÇΩ", "–£–∫—Ä–æ–ø —Å—É—à—ë–Ω—ã–π", 18, "spices"],
["üå∂Ô∏è –ü–µ—Ä–µ—Ü —á—ë—Ä–Ω—ã–π –º–æ–ª–æ—Ç—ã–π ‚Äî 20 ‚ÇΩ", "–ü–µ—Ä–µ—Ü —á—ë—Ä–Ω—ã–π –º–æ–ª–æ—Ç—ã–π", 20, "spices"],
["üå∂Ô∏è –ü–µ—Ä–µ—Ü —á—ë—Ä–Ω—ã–π –≥–æ—Ä–æ—à–µ–∫ ‚Äî 85 ‚ÇΩ", "–ü–µ—Ä–µ—Ü —á—ë—Ä–Ω—ã–π –≥–æ—Ä–æ—à–µ–∫ 85", 85, "spices"],
["üå∂Ô∏è –ü–µ—Ä–µ—Ü —á—ë—Ä–Ω—ã–π –≥–æ—Ä–æ—à–µ–∫ ‚Äî 50 ‚ÇΩ", "–ü–µ—Ä–µ—Ü —á—ë—Ä–Ω—ã–π –≥–æ—Ä–æ—à–µ–∫ 50", 50, "spices"],
["üå∂Ô∏è –ü–µ—Ä–µ—Ü —á—ë—Ä–Ω—ã–π –≥–æ—Ä–æ—à–µ–∫ ‚Äî 60 ‚ÇΩ", "–ü–µ—Ä–µ—Ü —á—ë—Ä–Ω—ã–π –≥–æ—Ä–æ—à–µ–∫ 60", 60, "spices"],
["üåø –ö–æ—Ä–∏—Ü–∞ ‚Äî 40 ‚ÇΩ", "–ö–æ—Ä–∏—Ü–∞", 40, "spices"],
["üå∂Ô∏è –ü–∞–ø—Ä–∏–∫–∞ —Å–ª–∞–¥–∫–∞—è ‚Äî 20 ‚ÇΩ", "–ü–∞–ø—Ä–∏–∫–∞ —Å–ª–∞–¥–∫–∞—è", 20, "spices"],
["üßÑ –ß–µ—Å–Ω–æ–∫ —Å—É—à—ë–Ω—ã–π ‚Äî 20 ‚ÇΩ", "–ß–µ—Å–Ω–æ–∫ —Å—É—à—ë–Ω—ã–π", 20, "spices"],
["üåø –ë–∞–∑–∏–ª–∏–∫ ‚Äî 12 ‚ÇΩ", "–ë–∞–∑–∏–ª–∏–∫ —Å—É—à—ë–Ω—ã–π", 12, "spices"],
["üü© –•–º–µ–ª–∏-—Å—É–Ω–µ–ª–∏ ‚Äî 25 ‚ÇΩ", "–•–º–µ–ª–∏-—Å—É–Ω–µ–ª–∏", 25, "spices"],
["ü•ò –ü—Ä–∏–ø—Ä–∞–≤—ã: –±–æ—Ä—â, –∫—É—Ä–∏–Ω–∞—è, —Å—É–ø, —Ñ–∞—Ä—à, —à–∞—à–ª—ã–∫, –º–∞–Ω—Ç—ã ‚Äî 18‚Äì40 ‚ÇΩ", "–ü—Ä–∏–ø—Ä–∞–≤—ã –∞—Å—Å–æ—Ä—Ç–∏", 40, "spices"],
["ü•§ –ì—Ä–∞–Ω–∞—Ç–æ–≤—ã–π —Å–æ–∫ Premium ‚Äî 325 ‚ÇΩ", "–ì—Ä–∞–Ω–∞—Ç–æ–≤—ã–π —Å–æ–∫ Premium", 325, "drinks"],
["ü•§ –ì—Ä–∞–Ω–∞—Ç–æ–≤—ã–π —Å–æ–∫ ‚Äî 240 ‚ÇΩ", "–ì—Ä–∞–Ω–∞—Ç–æ–≤—ã–π —Å–æ–∫", 240, "drinks"],
["ü•§ –ì—Ä–∞–Ω–∞—Ç–æ–≤—ã–π —Å–æ–∫ ‚Äî 95 ‚ÇΩ", "–ì—Ä–∞–Ω–∞—Ç–æ–≤—ã–π —Å–æ–∫ 95", 95, "drinks"],
["ü•ï –°–æ–∫ –ú–æ—Ä–∫–æ–≤—å ‚Äî 95 ‚ÇΩ", "–°–æ–∫ –ú–æ—Ä–∫–æ–≤—å", 95, "drinks"],
["üçÖ –¢–æ–º–∞—Ç–Ω—ã–π —Å–æ–∫ ‚Äî 190 ‚ÇΩ", "–¢–æ–º–∞—Ç–Ω—ã–π —Å–æ–∫", 190, "drinks"],
["üßÉ –°–æ–∫–∏ –î–æ–±—Ä—ã–π ‚Äî 135 ‚ÇΩ", "–°–æ–∫–∏ –î–æ–±—Ä—ã–π", 135, "drinks"],
["üßÉ Ju100 ‚Äî 65‚Äì80 ‚ÇΩ", "Ju100", 80, "drinks"],
["ü•§ RC Cola ‚Äî 175 ‚ÇΩ", "RC Cola", 175, "drinks"],
["ü•§ RC Refresher ‚Äî 175 ‚ÇΩ", "RC Refresher", 175, "drinks"],
["üßã Bubble Tea ‚Äî 145 ‚ÇΩ", "Bubble Tea", 145, "drinks"],
["ü•§ –ö–≤–∞—Å –î–æ–º–∞—à–Ω–∏–π ‚Äî 130 ‚ÇΩ", "–ö–≤–∞—Å –î–æ–º–∞—à–Ω–∏–π", 130, "drinks"],
["ü•§ –ö–≤–∞—Å –û–∫—Ä–æ—à–µ—á–Ω—ã–π ‚Äî 130 ‚ÇΩ", "–ö–≤–∞—Å –û–∫—Ä–æ—à–µ—á–Ω—ã–π", 130, "drinks"],
["üçè –¢–∞—Ä—Ö—É–Ω ‚Äî 95 ‚ÇΩ", "–¢–∞—Ä—Ö—É–Ω", 95, "drinks"],
["üçá –°–∞–ø–µ—Ä–∞–≤–∏ ‚Äî 95 ‚ÇΩ", "–°–∞–ø–µ—Ä–∞–≤–∏", 95, "drinks"],
["üåø –†–∞—Å—Ç–æ—Ä–æ–ø—à–∞ ‚Äî 95 ‚ÇΩ", "–†–∞—Å—Ç–æ—Ä–æ–ø—à–∞", 95, "drinks"],
["ü•§ –ù–∞—Ç–∞—Ö—Ç–∞—Ä–∏ –ì—Ä—É—à–∞ ‚Äî 120 ‚ÇΩ", "–ù–∞—Ç–∞—Ö—Ç–∞—Ä–∏ –ì—Ä—É—à–∞", 120, "drinks"],
["ü•§ –õ–∏–º–æ–Ω–∞–¥—ã –í–æ–ª–∂–∞–Ω–∫–∞ ‚Äî 70 ‚ÇΩ", "–õ–∏–º–æ–Ω–∞–¥—ã –í–æ–ª–∂–∞–Ω–∫–∞", 70, "drinks"],
["üíß –í–æ–ª–∂–∞–Ω–∫–∞ 0.5 –Ω–µ–≥–∞–∑ ‚Äî 40 ‚ÇΩ", "–í–æ–ª–∂–∞–Ω–∫–∞ 0.5 –Ω–µ–≥–∞–∑", 40, "drinks"],
["üíß –í–æ–ª–∂–∞–Ω–∫–∞ 0.5 –≥–∞–∑ ‚Äî 40 ‚ÇΩ", "–í–æ–ª–∂–∞–Ω–∫–∞ 0.5 –≥–∞–∑", 40, "drinks"],
["üíß –í–æ–ª–∂–∞–Ω–∫–∞ 1 –ª –≥–∞–∑ ‚Äî 48 ‚ÇΩ", "–í–æ–ª–∂–∞–Ω–∫–∞ 1–ª –≥–∞–∑", 48, "drinks"],
["üíß –í–æ–ª–∂–∞–Ω–∫–∞ 1 –ª –Ω–µ–≥–∞–∑ ‚Äî 48 ‚ÇΩ", "–í–æ–ª–∂–∞–Ω–∫–∞ 1–ª –Ω–µ–≥–∞–∑", 48, "drinks"],
["üíß –í–æ–ª–∂–∞–Ω–∫–∞ 1.5 –ª –≥–∞–∑ ‚Äî 56 ‚ÇΩ", "–í–æ–ª–∂–∞–Ω–∫–∞ 1.5–ª –≥–∞–∑", 56, "drinks"],
["üíß –í–æ–ª–∂–∞–Ω–∫–∞ 1.5 –ª –Ω–µ–≥–∞–∑ ‚Äî 56 ‚ÇΩ", "–í–æ–ª–∂–∞–Ω–∫–∞ 1.5–ª –Ω–µ–≥–∞–∑", 56, "drinks"],
["üíß –í–æ–ª–∂–∞–Ω–∫–∞ 5 –ª ‚Äî 100 ‚ÇΩ", "–í–æ–ª–∂–∞–Ω–∫–∞ 5–ª", 100, "drinks"],
["ü•§ Cola Classic ‚Äî 100 ‚ÇΩ", "Cola Classic", 100, "drinks"],
["üçö –†–∏—Å ‚Äî 260 ‚ÇΩ", "–†–∏—Å", 260, "cereals"],
["üçö Basmati –†–∏—Å ‚Äî 580 ‚ÇΩ", "–†–∏—Å Basmati", 580, "cereals"],
["üçö Bondo Chef Basmati ‚Äî 520 ‚ÇΩ", "–†–∏—Å Bondo Chef Basmati", 520, "cereals"],
["üçö –†–∏—Å –ë–∞—Ä–∞–∫–∞—Ç ‚Äî 445 ‚ÇΩ", "–†–∏—Å –ë–∞—Ä–∞–∫–∞—Ç", 445, "cereals"],
["üçö –†–∏—Å –ò—Ö–ª–∞—Å ‚Äî 310 ‚ÇΩ", "–†–∏—Å –ò—Ö–ª–∞—Å", 310, "cereals"],
["üçö –†–∏—Å Mujdeh ‚Äî 250 ‚ÇΩ", "–†–∏—Å Mujdeh", 250, "cereals"],
["üçö –†–∏—Å –ó–æ–ª–æ—Ç–æ–π –ö–∞–∑–∞–Ω ‚Äî 540 ‚ÇΩ", "–†–∏—Å –ó–æ–ª–æ—Ç–æ–π –ö–∞–∑–∞–Ω", 540, "cereals"],
["üçö –†–∏—Å –ê–π–¥–æ–Ω–∏ ‚Äî 210 ‚ÇΩ", "–†–∏—Å –ê–π–¥–æ–Ω–∏", 210, "cereals"],
["üçõ –ì–æ—Ä–æ—à–µ–∫ ‚Äî 75 ‚ÇΩ", "–ì–æ—Ä–æ—à–µ–∫", 75, "cereals"],
["ü•´ –ë–æ–Ω–¥—é—ç–ª—å (–≥–æ—Ä–æ—à–µ–∫/–∫—É–∫—É—Ä—É–∑–∞) ‚Äî 110 ‚ÇΩ", "–ë–æ–Ω–¥—é—ç–ª—å", 110, "cereals"],
["ü•´ –î–æ–º–∞—à–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç—ã –≥–æ—Ä–æ—à–µ–∫ ‚Äî 92 ‚ÇΩ", "–î–æ–º–∞—à–Ω–∏–π –≥–æ—Ä–æ—à–µ–∫", 92, "cereals"],
["ü•´ –î—è–¥—è –í–∞–Ω—è –≥–æ—Ä–æ—à–µ–∫ ‚Äî 95 ‚ÇΩ", "–î—è–¥—è –í–∞–Ω—è –≥–æ—Ä–æ—à–µ–∫", 95, "cereals"],
["ü•´ –°–ö–ó –≥–æ—Ä–æ—à–µ–∫ ‚Äî 85 ‚ÇΩ", "–°–ö–ó –≥–æ—Ä–æ—à–µ–∫", 85, "cereals"],
["üçÖ –¢–æ–º–∞—Ç–Ω–∞—è –ø–∞—Å—Ç–∞ –ö—É—Ö–º–∞—Å—Ç–µ—Ä ‚Äî 110 ‚ÇΩ", "–¢–æ–º–∞—Ç–Ω–∞—è –ø–∞—Å—Ç–∞ 110", 110, "cereals"],
["üçÖ –¢–æ–º–∞—Ç–Ω–∞—è –ø–∞—Å—Ç–∞ –ö—É—Ö–º–∞—Å—Ç–µ—Ä ‚Äî 125 ‚ÇΩ", "–¢–æ–º–∞—Ç–Ω–∞—è –ø–∞—Å—Ç–∞ 125", 125, "cereals"],
["üçÖ –¢–æ–º–∞—Ç–Ω–∞—è –ø–∞—Å—Ç–∞ –ö—É—Ö–º–∞—Å—Ç–µ—Ä ‚Äî 156 ‚ÇΩ", "–¢–æ–º–∞—Ç–Ω–∞—è –ø–∞—Å—Ç–∞ 156", 156, "cereals"],
["üçÖ –¢–æ–º–∞—Ç–Ω–∞—è –ø–∞—Å—Ç–∞ –ö—É—Ö–º–∞—Å—Ç–µ—Ä ‚Äî 285 ‚ÇΩ", "–¢–æ–º–∞—Ç–Ω–∞—è –ø–∞—Å—Ç–∞ 285", 285, "cereals"],
["ü•´ –°–æ—É—Å –ê—Ä–º—è–Ω—Å–∫–∏–π ‚Äî 125 ‚ÇΩ", "–°–æ—É—Å –ê—Ä–º—è–Ω—Å–∫–∏–π", 125, "cereals"],
["üõ¢ –ú–∞—Å–ª–æ –ê–Ω–Ω–∏–Ω—Å–∫–æ–µ ‚Äî 150 ‚ÇΩ", "–ú–∞—Å–ª–æ –ê–Ω–Ω–∏–Ω—Å–∫–æ–µ", 150, "cereals"],
["üõ¢ –ú–∞—Å–ª–æ –ë–ª–∞–≥–æ ‚Äî 160 ‚ÇΩ", "–ú–∞—Å–ª–æ –ë–ª–∞–≥–æ", 160, "cereals"],
["üõ¢ –ú–∞—Å–ª–æ –î–∞—Ä—ã –ö—É–±–∞–Ω–∏ ‚Äî 140 ‚ÇΩ", "–ú–∞—Å–ª–æ –î–∞—Ä—ã –ö—É–±–∞–Ω–∏", 140, "cereals"],
["üßÇ –°–∞—Ö–∞—Ä ‚Äî 68 ‚ÇΩ", "–°–∞—Ö–∞—Ä", 68, "cereals"],
["üßÇ –°–æ–ª—å –ò–ª–µ—Ü–∫–∞—è ‚Äî 25 ‚ÇΩ", "–°–æ–ª—å –ò–ª–µ—Ü–∫–∞—è", 25, "cereals"],
["üßÇ –°–æ–¥–∞ ‚Äî 48 ‚ÇΩ", "–°–æ–¥–∞", 48, "cereals"],
["üçö –°–∞—Ö–∞—Ä–Ω–∞—è –ø—É–¥—Ä–∞ ‚Äî 31 ‚ÇΩ", "–°–∞—Ö–∞—Ä–Ω–∞—è –ø—É–¥—Ä–∞", 31, "cereals"],
["‚òï –ê–∑–µ—Ä—á–∞–π ‚Äî 120 ‚ÇΩ", "–ê–∑–µ—Ä—á–∞–π", 120, "tea"],
["‚òï Richard Lord Grey ‚Äî 120 ‚ÇΩ", "Richard Lord Grey", 120, "tea"],
["‚òï Richard Royal Ceylon ‚Äî 135 ‚ÇΩ", "Richard Royal Ceylon", 135, "tea"],
["‚òï Berqa Earl Grey ‚Äî 200 ‚ÇΩ", "Berqa Earl Grey", 200, "tea"],
["‚òï Greenfield Golden Ceylon ‚Äî 134 ‚ÇΩ", "Greenfield Golden Ceylon", 134, "tea"],
["‚òï Greenfield Earl Grey Fantasy ‚Äî 160 ‚ÇΩ", "Greenfield Earl Grey Fantasy", 160, "tea"],
["‚òï Sundari Black Tea ‚Äî 250 ‚ÇΩ", "Sundari Black Tea", 250, "tea"],
["‚òï Al-Jannat Gold ‚Äî 250 ‚ÇΩ", "Al-Jannat Gold", 250, "tea"],
["‚òï ZenZur Bergamot ‚Äî 250 ‚ÇΩ", "ZenZur Bergamot", 250, "tea"],
["üßª –¢—É–∞–ª–µ—Ç–Ω–∞—è –±—É–º–∞–≥–∞ ‚Äî 35 ‚ÇΩ", "–¢—É–∞–ª–µ—Ç–Ω–∞—è –±—É–º–∞–≥–∞", 35, "household"],
];

// —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø–æ–¥–±–æ—Ä–∫–∏ –¥–ª—è –±–ª–æ–∫–æ–≤ "–í—ã–≥–æ–¥–Ω–æ / –°–µ–∑–æ–Ω / –•–∏—Ç—ã / –ü–æ–¥ –∑–∞–∫–∞–∑"
const specialFilters = {
  "sweet-tea":      p => getCategory(p) === 'fruits',                    // "–°–ª–∞–¥–∫–∏–µ —Ñ—Ä—É–∫—Ç—ã –∫ —á–∞—é"
  "borsch-set":     p => getCategory(p) === 'vegetables',                // "–ù–∞–±–æ—Ä –¥–ª—è –±–æ—Ä—â–∞"
  "summer-fruits":  p => getCategory(p) === 'fruits',                    // "–õ–µ—Ç–Ω–∏–µ —Ñ—Ä—É–∫—Ç—ã"
  "grill-veg":      p => getCategory(p) === 'vegetables',                // "–û–≤–æ—â–∏ –¥–ª—è –≥—Ä–∏–ª—è"
  "popular-fruits": p => getCategory(p) === 'fruits',                    // "–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ñ—Ä—É–∫—Ç—ã"
  "breakfast":      p => ['sweets', 'tea', 'drinks', 'cereals']
                        .includes(getCategory(p)),                       // "–¢–æ–≤–∞—Ä—ã –¥–ª—è –∑–∞–≤—Ç—Ä–∞–∫–∞"
  "preorder-fruits":p => getCategory(p) === 'fruits',                    // "–§—Ä—É–∫—Ç—ã –æ–ø—Ç–æ–º"
  "preorder-rare":  p => ['tea', 'nuts', 'canned']
                        .includes(getCategory(p))                        // "–†–µ–¥–∫–∏–µ —Ç–æ–≤–∞—Ä—ã"
};

/* KBJU and descriptions */
const kbjuData = {
  "–ì—Ä—É—à–∞": { kbju: "57 –∫–∫–∞–ª ‚Ä¢ –ë 0.4 –≥ ‚Ä¢ –ñ 0.4 –≥ ‚Ä¢ –£ 15 –≥", desc: "üçê –û—Ç–ª–∏—á–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∫–ª–µ—Ç—á–∞—Ç–∫–∏, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∑–¥–æ—Ä–æ–≤–æ–µ –ø–∏—â–µ–≤–∞—Ä–µ–Ω–∏–µ –∏ —Å–Ω–∏–∂–∞–µ—Ç —É—Ä–æ–≤–µ–Ω—å —Ö–æ–ª–µ—Å—Ç–µ—Ä–∏–Ω–∞." },
  "–ê–ø–µ–ª—å—Å–∏–Ω": { kbju: "47 –∫–∫–∞–ª ‚Ä¢ –ë 0.9 –≥ ‚Ä¢ –ñ 0.1 –≥ ‚Ä¢ –£ 11.8 –≥", desc: "üçä –ú–æ—â–Ω—ã–π –∑–∞—Ä—è–¥ –≤–∏—Ç–∞–º–∏–Ω–∞ C, —É–∫—Ä–µ–ø–ª—è–µ—Ç –∏–º–º—É–Ω–∏—Ç–µ—Ç –∏ –ø–æ–≤—ã—à–∞–µ—Ç —É—Ä–æ–≤–µ–Ω—å —ç–Ω–µ—Ä–≥–∏–∏." },
  "–î—ã–Ω—è —Ç–æ—Ä–ø–µ–¥–∞ –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω": { kbju: "35 –∫–∫–∞–ª ‚Ä¢ –ë 0.8 –≥ ‚Ä¢ –ñ 0.2 –≥ ‚Ä¢ –£ 8 –≥", desc: "üçà –û—Å–≤–µ–∂–∞—é—â–∞—è, –Ω–∞—Å—ã—â–µ–Ω–∞ –∫–∞–ª–∏–µ–º –∏ –≤–∏—Ç–∞–º–∏–Ω–æ–º C, —Å–ø–æ—Å–æ–±—Å—Ç–≤—É–µ—Ç –¥–µ—Ç–æ–∫—Å–∏–∫–∞—Ü–∏–∏ –æ—Ä–≥–∞–Ω–∏–∑–º–∞." },
  "–î—ã–Ω—è –∫–æ–ª—Ö–æ–∑–Ω–∏—Ü–∞": { kbju: "36 –∫–∫–∞–ª ‚Ä¢ –ë 0.6 –≥ ‚Ä¢ –ñ 0.3 –≥ ‚Ä¢ –£ 8.1 –≥", desc: "üçà –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–æ–¥–Ω—ã–π –±–∞–ª–∞–Ω—Å, –º—è–≥–∫–æ —É–ª—É—á—à–∞–µ—Ç –æ–±–º–µ–Ω –≤–µ—â–µ—Å—Ç–≤." },
  "–í–∏–Ω–æ–≥—Ä–∞–¥ –∑–µ–ª–µ–Ω—ã–π (–±–µ–∑ –∫–æ—Å—Ç–æ—á–µ–∫)": { kbju: "69 –∫–∫–∞–ª ‚Ä¢ –ë 0.7 –≥ ‚Ä¢ –ñ 0.2 –≥ ‚Ä¢ –£ 18 –≥", desc: "üçá –ò—Å—Ç–æ—á–Ω–∏–∫ –∞–Ω—Ç–∏–æ–∫—Å–∏–¥–∞–Ω—Ç–æ–≤, —É–∫—Ä–µ–ø–ª—è–µ—Ç —Å–µ—Ä–¥—Ü–µ –∏ —Å–æ—Å—É–¥—ã." },
  "–í–∏–Ω–æ–≥—Ä–∞–¥ —Ç–µ–º–Ω—ã–π (–±–µ–∑ –∫–æ—Å—Ç–æ—á–µ–∫)": { kbju: "70 –∫–∫–∞–ª ‚Ä¢ –ë 0.6 –≥ ‚Ä¢ –ñ 0.2 –≥ ‚Ä¢ –£ 18 –≥", desc: "üçá –°–æ–¥–µ—Ä–∂–∏—Ç —Ä–µ—Å–≤–µ—Ä–∞—Ç—Ä–æ–ª ‚Äî –º–æ—â–Ω—ã–π –∞–Ω—Ç–∏–æ–∫—Å–∏–¥–∞–Ω—Ç –¥–ª—è –º–æ–ª–æ–¥–æ—Å—Ç–∏ –∫–æ–∂–∏ –∏ —Å–æ—Å—É–¥–æ–≤." },
  "–í–∏–Ω–æ–≥—Ä–∞–¥ —á–µ—Ä–Ω—ã–π (–ú–µ—Ä—Å–µ–¥–µ—Å)": { kbju: "72 –∫–∫–∞–ª ‚Ä¢ –ë 0.7 –≥ ‚Ä¢ –ñ 0.2 –≥ ‚Ä¢ –£ 17 –≥", desc: "üçá –ë–ª–∞–≥–æ—Ç–≤–æ—Ä–Ω–æ –≤–ª–∏—è–µ—Ç –Ω–∞ —Å–µ—Ä–¥—Ü–µ –∏ –∏–º–º—É–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É." },
  "–ù–µ–∫—Ç–∞—Ä–∏–Ω –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω –∫—Ä–∞—Å–Ω—ã–π": { kbju: "44 –∫–∫–∞–ª ‚Ä¢ –ë 1.1 –≥ ‚Ä¢ –ñ 0.3 –≥ ‚Ä¢ –£ 10 –≥", desc: "üçë –ë–æ–≥–∞—Ç –≤–∏—Ç–∞–º–∏–Ω–æ–º A –∏ –∞–Ω—Ç–∏–æ–∫—Å–∏–¥–∞–Ω—Ç–∞–º–∏, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∑–¥–æ—Ä–æ–≤—å–µ –∫–æ–∂–∏." },
  "–ù–µ–∫—Ç–∞—Ä–∏–Ω –¢—É—Ä—Ü–∏—è": { kbju: "45 –∫–∫–∞–ª ‚Ä¢ –ë 1 –≥ ‚Ä¢ –ñ 0.3 –≥ ‚Ä¢ –£ 10 –≥", desc: "üçë –£–ª—É—á—à–∞–µ—Ç –æ–±–º–µ–Ω –≤–µ—â–µ—Å—Ç–≤ –∏ —Å–ø–æ—Å–æ–±—Å—Ç–≤—É–µ—Ç –∑–¥–æ—Ä–æ–≤–æ–º—É –ø–∏—â–µ–≤–∞—Ä–µ–Ω–∏—é." },
  "–ù–µ–∫—Ç–∞—Ä–∏–Ω –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω –∂–µ–ª—Ç—ã–π (–≤–∫—É—Å –ª–∏–º–æ–Ω)": { kbju: "45 –∫–∫–∞–ª ‚Ä¢ –ë 1 –≥ ‚Ä¢ –ñ 0.3 –≥ ‚Ä¢ –£ 10 –≥", desc: "üçë –°–æ—á–Ω—ã–π –∏ –∞—Ä–æ–º–∞—Ç–Ω—ã–π —Ñ—Ä—É–∫—Ç, —É–∫—Ä–µ–ø–ª—è–µ—Ç –∏–º–º—É–Ω–∏—Ç–µ—Ç –∏ –ø—Ä–∏–¥–∞—ë—Ç —ç–Ω–µ—Ä–≥–∏–∏." },
  "–ù–µ–∫—Ç–∞—Ä–∏–Ω –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω –∑–µ–ª–µ–Ω—ã–π": { kbju: "44 –∫–∫–∞–ª ‚Ä¢ –ë 1.1 –≥ ‚Ä¢ –ñ 0.3 –≥ ‚Ä¢ –£ 10 –≥", desc: "üçë –û—Å–≤–µ–∂–∞–µ—Ç –∏ –ø–æ–º–æ–≥–∞–µ—Ç –æ—á–∏—â–∞—Ç—å –æ—Ä–≥–∞–Ω–∏–∑–º." },
  "–ë–∞–Ω–∞–Ω": { kbju: "89 –∫–∫–∞–ª ‚Ä¢ –ë 1.1 –≥ ‚Ä¢ –ñ 0.3 –≥ ‚Ä¢ –£ 23 –≥", desc: "üçå –ò—Å—Ç–æ—á–Ω–∏–∫ –∫–∞–ª–∏—è –∏ –º–∞–≥–Ω–∏—è ‚Äî –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–µ—Ä–¥—Ü–µ –∏ –Ω–µ—Ä–≤–Ω—É—é —Å–∏—Å—Ç–µ–º—É." },
  "–°–ª–∏–≤–∞ 4 –≤–∏–¥–∞": { kbju: "46 –∫–∫–∞–ª ‚Ä¢ –ë 0.7 –≥ ‚Ä¢ –ñ 0.3 –≥ ‚Ä¢ –£ 11 –≥", desc: "üçë –ü–æ–º–æ–≥–∞–µ—Ç –æ—á–∏—â–∞—Ç—å –∫–∏—à–µ—á–Ω–∏–∫, –±–æ–≥–∞—Ç–∞ –∞–Ω—Ç–∏–æ–∫—Å–∏–¥–∞–Ω—Ç–∞–º–∏ –∏ –≤–∏—Ç–∞–º–∏–Ω–æ–º C." },
  "–ß–µ—Ä–µ—à–Ω—è": { kbju: "63 –∫–∫–∞–ª ‚Ä¢ –ë 1.1 –≥ ‚Ä¢ –ñ 0.2 –≥ ‚Ä¢ –£ 16 –≥", desc: "üçí –£–∫—Ä–µ–ø–ª—è–µ—Ç —Å–æ—Å—É–¥—ã, —É–ª—É—á—à–∞–µ—Ç —Å–æ–Ω –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ." },
  "–ì–æ–ª—É–±–∏–∫–∞": { kbju: "57 –∫–∫–∞–ª ‚Ä¢ –ë 0.7 –≥ ‚Ä¢ –ñ 0.3 –≥ ‚Ä¢ –£ 14 –≥", desc: "ü´ê –û–¥–∏–Ω –∏–∑ –ª—É—á—à–∏—Ö –∞–Ω—Ç–∏–æ–∫—Å–∏–¥–∞–Ω—Ç–æ–≤, —É–ª—É—á—à–∞–µ—Ç –ø–∞–º—è—Ç—å –∏ –∑—Ä–µ–Ω–∏–µ." },
  "–ê–±—Ä–∏–∫–æ—Å –ê—Ä–º–µ–Ω–∏—è": { kbju: "48 –∫–∫–∞–ª ‚Ä¢ –ë 1.4 –≥ ‚Ä¢ –ñ 0.4 –≥ ‚Ä¢ –£ 11 –≥", desc: "üçë –ë–æ–≥–∞—Ç –±–µ—Ç–∞-–∫–∞—Ä–æ—Ç–∏–Ω–æ–º, —É–ª—É—á—à–∞–µ—Ç –∑—Ä–µ–Ω–∏–µ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–∂–∏." },
  "–ê–±—Ä–∏–∫–æ—Å –ö–∏—Ä–≥–∏–∑–∏—è": { kbju: "48 –∫–∫–∞–ª ‚Ä¢ –ë 1.4 –≥ ‚Ä¢ –ñ 0.4 –≥ ‚Ä¢ –£ 11 –≥", desc: "üçë –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞–±–æ—Ç—É –ø–µ—á–µ–Ω–∏ –∏ —Å–ø–æ—Å–æ–±—Å—Ç–≤—É–µ—Ç –≤—ã—Ä–∞–±–æ—Ç–∫–µ –∫–æ–ª–ª–∞–≥–µ–Ω–∞." },
  "–ü–µ—Ä—Å–∏–∫ –¢–∞—à–∫–µ–Ω—Ç": { kbju: "39 –∫–∫–∞–ª ‚Ä¢ –ë 0.9 –≥ ‚Ä¢ –ñ 0.3 –≥ ‚Ä¢ –£ 10 –≥", desc: "üçë –ü–æ–º–æ–≥–∞–µ—Ç –æ—á–∏—â–µ–Ω–∏—é –æ—Ä–≥–∞–Ω–∏–∑–º–∞ –∏ —É–∫—Ä–µ–ø–ª—è–µ—Ç –∏–º–º—É–Ω–∏—Ç–µ—Ç." },
  "–ü–µ—Ä—Å–∏–∫ –ê—Ä–º–µ–Ω–∏—è": { kbju: "39 –∫–∫–∞–ª ‚Ä¢ –ë 0.9 –≥ ‚Ä¢ –ñ 0.3 –≥ ‚Ä¢ –£ 10 –≥", desc: "üçë –ò—Å—Ç–æ—á–Ω–∏–∫ –≤–∏—Ç–∞–º–∏–Ω–æ–≤ A –∏ E, —É–ª—É—á—à–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–∂–∏ –∏ –≤–æ–ª–æ—Å." },
  "–ü–µ—Ä—Å–∏–∫ –¢—É—Ä—Ü–∏—è": { kbju: "39 –∫–∫–∞–ª ‚Ä¢ –ë 0.9 –≥ ‚Ä¢ –ñ 0.3 –≥ ‚Ä¢ –£ 10 –≥", desc: "üçë –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–±–º–µ–Ω –≤–µ—â–µ—Å—Ç–≤ –∏ –≤–æ—Å–ø–æ–ª–Ω—è–µ—Ç –∑–∞–ø–∞—Å—ã –∞–Ω—Ç–∏–æ–∫—Å–∏–¥–∞–Ω—Ç–æ–≤." },
  "–ü–µ—Ä—Å–∏–∫ –ò–Ω–∂–∏—Ä–Ω—ã–π": { kbju: "40 –∫–∫–∞–ª ‚Ä¢ –ë 0.9 –≥ ‚Ä¢ –ñ 0.3 –≥ ‚Ä¢ –£ 10 –≥", desc: "üçë –°–ª–∞–¥–∫–∏–π –∏ –Ω–µ–∂–Ω—ã–π, –ø–æ–º–æ–≥–∞–µ—Ç –ø—Ä–∏ —É—Å—Ç–∞–ª–æ—Å—Ç–∏ –∏ —Å—Ç—Ä–µ—Å—Å–∞—Ö." },
  "–ö–∏–≤–∏": { kbju: "41 –∫–∫–∞–ª ‚Ä¢ –ë 1.1 –≥ ‚Ä¢ –ñ 0.5 –≥ ‚Ä¢ –£ 10 –≥", desc: "ü•ù –°–æ–¥–µ—Ä–∂–∏—Ç –±–æ–ª—å—à–µ –≤–∏—Ç–∞–º–∏–Ω–∞ C, —á–µ–º –∞–ø–µ–ª—å—Å–∏–Ω, —É–∫—Ä–µ–ø–ª—è–µ—Ç –∏–º–º—É–Ω–∏—Ç–µ—Ç –∏ —É–ª—É—á—à–∞–µ—Ç –ø–∏—â–µ–≤–∞—Ä–µ–Ω–∏–µ." },
  "–õ–∏–º–æ–Ω": { kbju: "29 –∫–∫–∞–ª ‚Ä¢ –ë 1.1 –≥ ‚Ä¢ –ñ 0.3 –≥ ‚Ä¢ –£ 9 –≥", desc: "üçã –ú–æ—â–Ω—ã–π –∞–Ω—Ç–∏–æ–∫—Å–∏–¥–∞–Ω—Ç, –æ—á–∏—â–∞–µ—Ç –æ—Ä–≥–∞–Ω–∏–∑–º –∏ —É–ª—É—á—à–∞–µ—Ç –æ–±–º–µ–Ω –≤–µ—â–µ—Å—Ç–≤." },
  "–ö–∞—Ä—Ç–æ—Ñ–µ–ª—å –ß—É–≤–∞—à–∏—è": { kbju: "77 –∫–∫–∞–ª ‚Ä¢ –ë 2 –≥ ‚Ä¢ –ñ 0.1 –≥ ‚Ä¢ –£ 17 –≥", desc: "ü•î –ò—Å—Ç–æ—á–Ω–∏–∫ –∫–∞–ª–∏—è –∏ –≤–∏—Ç–∞–º–∏–Ω–∞ B6, –¥–∞—ë—Ç —ç–Ω–µ—Ä–≥–∏—é –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –Ω–µ—Ä–≤–Ω—É—é —Å–∏—Å—Ç–µ–º—É." },
  "–ö–∞—Ä—Ç–æ—Ñ–µ–ª—å –ö—Ä–∞—Å–Ω–æ–¥–∞—Ä": { kbju: "77 –∫–∫–∞–ª ‚Ä¢ –ë 2 –≥ ‚Ä¢ –ñ 0.1 –≥ ‚Ä¢ –£ 17 –≥", desc: "ü•î –ü–æ–ª–µ–∑–µ–Ω –ø—Ä–∏ —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö –Ω–∞–≥—Ä—É–∑–∫–∞—Ö, —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–ª–µ—Ç—á–∞—Ç–∫—É –∏ –∞–Ω—Ç–∏–æ–∫—Å–∏–¥–∞–Ω—Ç—ã." },
  "–ú–æ—Ä–∫–æ–≤—å –í–æ–ª–≥–æ–≥—Ä–∞–¥": { kbju: "41 –∫–∫–∞–ª ‚Ä¢ –ë 0.9 –≥ ‚Ä¢ –ñ 0.2 –≥ ‚Ä¢ –£ 10 –≥", desc: "ü•ï –ë–æ–≥–∞—Ç–∞ –±–µ—Ç–∞-–∫–∞—Ä–æ—Ç–∏–Ω–æ–º, —É–ª—É—á—à–∞–µ—Ç –∑—Ä–µ–Ω–∏–µ –∏ —É–∫—Ä–µ–ø–ª—è–µ—Ç –∫–æ–∂—É." },
  "–õ—É–∫ —Ä–µ–ø—á–∞—Ç—ã–π –í–æ–ª–≥–æ–≥—Ä–∞–¥": { kbju: "40 –∫–∫–∞–ª ‚Ä¢ –ë 1.1 –≥ ‚Ä¢ –ñ 0.1 –≥ ‚Ä¢ –£ 9.3 –≥", desc: "üßÖ –ü–æ–≤—ã—à–∞–µ—Ç –∏–º–º—É–Ω–∏—Ç–µ—Ç, –æ–±–ª–∞–¥–∞–µ—Ç –ø—Ä–æ—Ç–∏–≤–æ–º–∏–∫—Ä–æ–±–Ω—ã–º–∏ —Å–≤–æ–π—Å—Ç–≤–∞–º–∏." },
  "–õ—É–∫ –∑–µ–ª–µ–Ω—ã–π": { kbju: "32 –∫–∫–∞–ª ‚Ä¢ –ë 1.8 –≥ ‚Ä¢ –ñ 0.2 –≥ ‚Ä¢ –£ 7.3 –≥", desc: "üå± –ò—Å—Ç–æ—á–Ω–∏–∫ –≤–∏—Ç–∞–º–∏–Ω–∞ C, –∂–µ–ª–µ–∑–∞ –∏ –∫–∞–ª—å—Ü–∏—è, –ø–æ–º–æ–≥–∞–µ—Ç —É–∫—Ä–µ–ø–∏—Ç—å –∫–æ—Å—Ç–∏." },
  "–£–∫—Ä–æ–ø, –ø–µ—Ç—Ä—É—à–∫–∞": { kbju: "43 –∫–∫–∞–ª ‚Ä¢ –ë 3 –≥ ‚Ä¢ –ñ 0.4 –≥ ‚Ä¢ –£ 8 –≥", desc: "üå± –£–ª—É—á—à–∞—é—Ç –ø–∏—â–µ–≤–∞—Ä–µ–Ω–∏–µ, –æ—Å–≤–µ–∂–∞—é—Ç –¥—ã—Ö–∞–Ω–∏–µ –∏ —Å–Ω–∞–±–∂–∞—é—Ç –æ—Ä–≥–∞–Ω–∏–∑–º –≤–∏—Ç–∞–º–∏–Ω–∞–º–∏." },
  "–ö–∏–Ω–∑–∞": { kbju: "23 –∫–∫–∞–ª ‚Ä¢ –ë 2.1 –≥ ‚Ä¢ –ñ 0.5 –≥ ‚Ä¢ –£ 3.7 –≥", desc: "üåø –°–ø–æ—Å–æ–±—Å—Ç–≤—É–µ—Ç –≤—ã–≤–µ–¥–µ–Ω–∏—é —Ç—è–∂—ë–ª—ã—Ö –º–µ—Ç–∞–ª–ª–æ–≤ –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–µ—Ç–æ–∫—Å–∏–∫–∞—Ü–∏—é –æ—Ä–≥–∞–Ω–∏–∑–º–∞." },
  "–ë–∞–∑–µ–ª–∏–∫ (–ø—É—á–æ–∫)": { kbju: "22 –∫–∫–∞–ª ‚Ä¢ –ë 3.2 –≥ ‚Ä¢ –ñ 0.6 –≥ ‚Ä¢ –£ 2.6 –≥", desc: "üåø –ë–æ–≥–∞—Ç —ç—Ñ–∏—Ä–Ω—ã–º–∏ –º–∞—Å–ª–∞–º–∏, —É–ª—É—á—à–∞–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏ –ø–∏—â–µ–≤–∞—Ä–µ–Ω–∏–µ." },
  "–ß–µ—Å–Ω–æ–∫ –¢–∞—à–∫–µ–Ω—Ç": { kbju: "149 –∫–∫–∞–ª ‚Ä¢ –ë 6.4 –≥ ‚Ä¢ –ñ 0.5 –≥ ‚Ä¢ –£ 33 –≥", desc: "üßÑ –ú–æ—â–Ω—ã–π –ø—Ä–∏—Ä–æ–¥–Ω—ã–π –∞–Ω—Ç–∏–±–∏–æ—Ç–∏–∫, —É–∫—Ä–µ–ø–ª—è–µ—Ç –∏–º–º—É–Ω–∏—Ç–µ—Ç –∏ —Å–µ—Ä–¥—Ü–µ." },
  "–ü–µ—Ä–µ—Ü –±–æ–ª–≥–∞—Ä—Å–∫–∏–π": { kbju: "27 –∫–∫–∞–ª ‚Ä¢ –ë 1.3 –≥ ‚Ä¢ –ñ 0.2 –≥ ‚Ä¢ –£ 6 –≥", desc: "ü´ë –û–¥–∏–Ω –∏–∑ –ª—É—á—à–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –≤–∏—Ç–∞–º–∏–Ω–∞ C, –ø–æ–≤—ã—à–∞–µ—Ç –∏–º–º—É–Ω–∏—Ç–µ—Ç –∏ —É–ª—É—á—à–∞–µ—Ç –∫–æ–∂—É." },
  "–ü–µ—Ä–µ—Ü —á–∏–ª–∏": { kbju: "40 –∫–∫–∞–ª ‚Ä¢ –ë 2 –≥ ‚Ä¢ –ñ 0.4 –≥ ‚Ä¢ –£ 9 –≥", desc: "üå∂Ô∏è –£–ª—É—á—à–∞–µ—Ç –æ–±–º–µ–Ω –≤–µ—â–µ—Å—Ç–≤ –∏ —Å–ø–æ—Å–æ–±—Å—Ç–≤—É–µ—Ç —Å–∂–∏–≥–∞–Ω–∏—é –∫–∞–ª–æ—Ä–∏–π." },
  "–ü–æ–º–∏–¥–æ—Ä—ã –ê–∑–µ—Ä–±–∞–π–¥–∂–∞–Ω—Å–∫–∏–µ": { kbju: "18 –∫–∫–∞–ª ‚Ä¢ –ë 0.9 –≥ ‚Ä¢ –ñ 0.2 –≥ ‚Ä¢ –£ 3.9 –≥", desc: "üçÖ –ë–æ–≥–∞—Ç—ã –ª–∏–∫–æ–ø–∏–Ω–æ–º, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç —Å–µ—Ä–¥—Ü–µ –∏ –∑–∞—â–∏—â–∞—é—Ç –∫–ª–µ—Ç–∫–∏ –æ—Ç —Å—Ç–∞—Ä–µ–Ω–∏—è." },
  "–ü–æ–º–∏–¥–æ—Ä—ã –†–æ—Å—Ç–æ–≤—Å–∫–∏–µ": { kbju: "18 –∫–∫–∞–ª ‚Ä¢ –ë 0.9 –≥ ‚Ä¢ –ñ 0.2 –≥ ‚Ä¢ –£ 3.9 –≥", desc: "üçÖ –û—Ç–ª–∏—á–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∞–Ω—Ç–∏–æ–∫—Å–∏–¥–∞–Ω—Ç–æ–≤ –∏ –≤–∏—Ç–∞–º–∏–Ω–∞ C." },
  "–ü–æ–º–∏–¥–æ—Ä—ã –í–æ–ª–≥–æ–≥—Ä–∞–¥ (–º–µ–ª–∫–∏–µ)": { kbju: "18 –∫–∫–∞–ª ‚Ä¢ –ë 0.9 –≥ ‚Ä¢ –ñ 0.2 –≥ ‚Ä¢ –£ 3.9 –≥", desc: "üçÖ –£–ª—É—á—à–∞—é—Ç –æ–±–º–µ–Ω –≤–µ—â–µ—Å—Ç–≤ –∏ —É–∫—Ä–µ–ø–ª—è—é—Ç –∏–º–º—É–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É." },
  "–ü–æ–º–∏–¥–æ—Ä—ã –¥–æ–º–∞—à–Ω–∏–µ": { kbju: "18 –∫–∫–∞–ª ‚Ä¢ –ë 0.9 –≥ ‚Ä¢ –ñ 0.2 –≥ ‚Ä¢ –£ 3.9 –≥", desc: "üçÖ –°–æ–¥–µ—Ä–∂–∞—Ç –Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ã–π –ª–∏–∫–æ–ø–∏–Ω, –∑–∞—â–∏—â–∞—é—Ç –∫–ª–µ—Ç–∫–∏ –æ—Ç —Å—Ç–∞—Ä–µ–Ω–∏—è." },
  "–ü–æ–º–∏–¥–æ—Ä—ã –ê—Å—Ç—Ä–∞—Ö–∞–Ω—å (–∂–µ–ª—Ç—ã–µ)": { kbju: "20 –∫–∫–∞–ª ‚Ä¢ –ë 1 –≥ ‚Ä¢ –ñ 0.2 –≥ ‚Ä¢ –£ 4 –≥", desc: "üçÖ –ú—è–≥—á–µ –ø–æ –∫–∏—Å–ª–æ—Ç–Ω–æ—Å—Ç–∏, –ø–æ–¥—Ö–æ–¥—è—Ç –¥–ª—è –ª—é–¥–µ–π —Å —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–º –∂–µ–ª—É–¥–∫–æ–º." },
  "–û–≥—É—Ä—Ü—ã –ú–æ—Å–∫–æ–≤—Å–∫–∏–µ": { kbju: "15 –∫–∫–∞–ª ‚Ä¢ –ë 0.8 –≥ ‚Ä¢ –ñ 0.1 –≥ ‚Ä¢ –£ 3.6 –≥", desc: "ü•í –°–æ—Å—Ç–æ—è—Ç –Ω–∞ 95 % –∏–∑ –≤–æ–¥—ã, –æ—á–∏—â–∞—é—Ç –æ—Ä–≥–∞–Ω–∏–∑–º –∏ —É–ª—É—á—à–∞—é—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–∂–∏." },
  "–û–≥—É—Ä—Ü—ã –°–∞–º–∞—Ä—Å–∫–∏–µ": { kbju: "15 –∫–∫–∞–ª ‚Ä¢ –ë 0.8 –≥ ‚Ä¢ –ñ 0.1 –≥ ‚Ä¢ –£ 3.6 –≥", desc: "ü•í –ü–æ–º–æ–≥–∞—é—Ç –≤—ã–≤–µ—Å—Ç–∏ –ª–∏—à–Ω—é—é –∂–∏–¥–∫–æ—Å—Ç—å –∏ —Ç–æ–Ω–∏–∑–∏—Ä—É—é—Ç." },
  "–û–≥—É—Ä—Ü—ã –¥–æ–º–∞—à–Ω–∏–µ": { kbju: "15 –∫–∫–∞–ª ‚Ä¢ –ë 0.8 –≥ ‚Ä¢ –ñ 0.1 –≥ ‚Ä¢ –£ 3.6 –≥", desc: "ü•í –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç –±–∞–ª–∞–Ω—Å –∂–∏–¥–∫–æ—Å—Ç–∏ –∏ —ç–ª–µ–∫—Ç—Ä–æ–ª–∏—Ç–æ–≤ –≤ –æ—Ä–≥–∞–Ω–∏–∑–º–µ." },
  "–ö–∞–±–∞—á–æ–∫": { kbju: "24 –∫–∫–∞–ª ‚Ä¢ –ë 1.5 –≥ ‚Ä¢ –ñ 0.3 –≥ ‚Ä¢ –£ 4.6 –≥", desc: "ü•í –õ–µ–≥–∫–æ —É—Å–≤–∞–∏–≤–∞–µ—Ç—Å—è, –±–æ–≥–∞—Ç –∫–ª–µ—Ç—á–∞—Ç–∫–æ–π –∏ –≤–∏—Ç–∞–º–∏–Ω–∞–º–∏ –≥—Ä—É–ø–ø—ã B." },
  "–ë–∞–∫–ª–∞–∂–∞–Ω": { kbju: "25 –∫–∫–∞–ª ‚Ä¢ –ë 1 –≥ ‚Ä¢ –ñ 0.2 –≥ ‚Ä¢ –£ 6 –≥", desc: "üçÜ –°–æ–¥–µ—Ä–∂–∏—Ç –∞–Ω—Ç–∏–æ–∫—Å–∏–¥–∞–Ω—Ç—ã, —Å–Ω–∏–∂–∞–µ—Ç —É—Ä–æ–≤–µ–Ω—å —Ö–æ–ª–µ—Å—Ç–µ—Ä–∏–Ω–∞ –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–µ—Ä–¥—Ü–µ." }
};
/* ========== SUPABASE INIT ========== */

const SUPABASE_URL = "https://pfrxetrirjmqppwjfftp.supabase.co";
const SUPABASE_ANON = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBmcnhldHJpcmptcXBwd2pmZnRwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM4NjU1ODksImV4cCI6MjA3OTQ0MTU4OX0.RUwkwZehK67E9LTkgFKRFYSTfC0Xx6o_JIdDG3IYngM";

// ‚ùó —Å–æ–∑–¥–∞—ë–º –∫–ª–∏–µ–Ω—Ç–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ
const db = supabase.createClient(SUPABASE_URL, SUPABASE_ANON);

console.log("Supabase –ø–æ–¥–∫–ª—é—á—ë–Ω:", db);

/* ========== AUTH FUNCTIONS ========== */

// –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –≤ localStorage
function saveUserLocally(user) {
  localStorage.setItem("bm_user", JSON.stringify(user));
}

// –ó–∞–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ
function getUserLocally() {
  const raw = localStorage.getItem("bm_user");
  return raw ? JSON.parse(raw) : null;
}

// –£–¥–∞–ª–∏—Ç—å
function clearUserLocally() {
  localStorage.removeItem("bm_user");
}

/* –í—Ö–æ–¥ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É  */
async function loginWithPhone(phone) {
  phone = phone.trim();
  if (!phone) {
    alert("–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞!");
    return;
  }

  // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π user_id
  const id = "phone_" + phone.replace(/\D/g, "");

  // –°–æ–∑–¥–∞—ë–º / –æ–±–Ω–æ–≤–ª—è–µ–º –∫–ª–∏–µ–Ω—Ç–∞
  const { data, error } = await db
    .from("customers")
    .upsert({
      id,
      phone,
      name: phone,
      loyalty_points: 0
    })
    .select()
    .single();

  if (error) {
    console.error("–û—à–∏–±–∫–∞ Supabase:", error);
    alert("–ü—Ä–æ–±–ª–µ–º–∞ —Å–æ –≤—Ö–æ–¥–æ–º!");
    return;
  }

  // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ç—Ä–æ–≥–æ —Ç–æ, —á—Ç–æ –≤–µ—Ä–Ω—É–ª Supabase:
  saveUserLocally(data);
  await refreshLoyalty();
  updateUserUI();

  document.getElementById("auth-modal").setAttribute("aria-hidden", "true");
  alert("–í—ã –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã!");
}

/* ========== AUTH REFS ========== */
const userAreaBtn = document.getElementById('user-area');
const authModal = document.getElementById('auth-modal');
const authClose = document.getElementById('auth-close');
const authPhone = document.getElementById('auth-phone');
const authPhoneBtn = document.getElementById('auth-phone-btn');
const authTg = document.getElementById('auth-tg');

/* ========== AUTH HANDLERS ========== */

// –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞ –∫–Ω–æ–ø–∫—É "–í–æ–π—Ç–∏" –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É
authPhoneBtn.addEventListener("click", () => {
  const phone = authPhone.value.trim();
  loginWithPhone(phone);
});

userAreaBtn.addEventListener("click", () => {
  const user = getUserLocally();

  // –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω ‚Äî –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–∫–Ω–æ –≤—Ö–æ–¥–∞
  if (!user) {
    if (authModal) {
      authModal.setAttribute("aria-hidden", "false");
    }
    return;
  }

  // –£–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω ‚Äî –æ—Ç–∫—Ä—ã–≤–∞–µ–º –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç
  openProfilePanel();
});

// –∑–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–∫–∏ –∫—Ä–µ—Å—Ç–∏–∫–æ–º
authClose.addEventListener("click", () => {
  authModal.setAttribute("aria-hidden", "true");
});

// –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞ –∫–Ω–æ–ø–∫—É "–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Telegram"
authTg.addEventListener("click", () => {
  loginWithTelegram();
});

/* ========== state & refs ========== */
let cart = [];
let visibleProducts = products.slice();
let currentFilter = 'all';

const catalogEl = document.getElementById('catalog');
const shownCountEl = document.getElementById('shown-count');
const filtersWrap = document.getElementById('filters');
const searchInput = document.getElementById('search-input');
const sortSelect = document.getElementById('sort-select');

const mobileSearchInput = document.getElementById('mobile-search-input');
const mobileSort = document.getElementById('mobile-sort');
const searchPanel = document.getElementById('search-panel');
const fabOpen = document.getElementById('search-fab');
const closeSearchPanelBtn = document.getElementById('close-search-panel');

const floatingCart = document.getElementById('floating-cart');
const fcCountEl = document.getElementById('fc-count');
const fcTotalEl = document.getElementById('fc-total');

const cartPanel = document.getElementById('cart-panel');
const cartItemsEl = document.getElementById('cart-items');
const cartSuggestList = document.getElementById('cart-suggest-list');
const cartSumEl = document.getElementById('cart-sum');
const cartCountSmall = document.getElementById('cart-count-2');
const cartCloseBtn = document.getElementById('cart-close-btn');
const gotoCheckoutBtn = document.getElementById('goto-checkout');

const checkoutOverlay = document.getElementById('checkout-overlay');
const modalOrderList = document.getElementById('modal-order-list');
const modalTotal = document.getElementById('modal-total');
const deliveryTimeSelect = document.getElementById('delivery-time');
const customTimeInput = document.getElementById('custom-time');
const deliveryModeDelivery = document.getElementById('delivery-mode-delivery');
const deliveryModePickup = document.getElementById('delivery-mode-pickup');
const pickupInfo = document.getElementById('pickup-info');
const fieldCity = document.getElementById('cust-city').closest('.form-row');
const fieldStreet = document.getElementById('cust-street').closest('.form-row');
const fieldHouse = document.getElementById('cust-house').closest('.col');
const fieldApt = document.getElementById('cust-apartment').closest('.col');
const deliveryTimeHint = document.getElementById('delivery-time-hint'); // ‚Üê –¥–æ–±–∞–≤–∏–ª–∏
const closeModalBtn = document.getElementById('close-modal');
const checkoutSubmitBtn = document.getElementById('checkout-submit');
const checkoutTimeDisplay = document.getElementById('checkout-time-display');
const addressSection = document.getElementById('address-section');


// –±–ª–æ–∫–∏ —Å–∞–º–æ–≤—ã–≤–æ–∑–∞
const pickupTimeSection = document.getElementById('pickup-time-section');
const pickupTimeSelect = document.getElementById('pickup-time');
const pickupCustomTimeRow = document.getElementById('pickup-custom-time-row');
const pickupCustomTimeInput = document.getElementById('pickup-custom-time');
const pickupTimeHint = document.getElementById('pickup-time-hint');

const loyaltyBadge = document.getElementById('loyalty-badge');
const heroOrderBtn = document.getElementById('hero-order');
const viewCatalogBtn = document.getElementById('view-catalog');

const heroSlides = document.querySelectorAll('.hero-slide');
const heroDots   = document.querySelectorAll('.hero-dot');

const categoryPanel = document.getElementById('category-panel');
const categoryBackBtn = document.getElementById('category-back');
const categoryPageTitle = document.getElementById('category-page-title');

const uaName = document.getElementById('ua-name');

const productModal = document.getElementById('product-modal');
const pmImg = document.getElementById('pm-img');
const pmName = document.getElementById('pm-name');
const pmPrice = document.getElementById('pm-price');
const pmKbju = document.getElementById('pm-kbju');
const pmMore = document.getElementById('pm-more');
const pmDesc = document.getElementById('pm-desc');
const pmClose = document.getElementById('product-modal-close');
const pmQty = document.getElementById('pm-qty');
const pmUnit = document.getElementById('pm-unit');
const pmAdd = document.getElementById('pm-add');

// === –ú–æ–∏ –∞–¥—Ä–µ—Å–∞ (localStorage) ===

function loadSavedAddresses() {
  try {
    const raw = localStorage.getItem('bm_addresses');
    return raw ? JSON.parse(raw) : [];
  } catch (e) {
    console.error('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ bm_addresses', e);
    return [];
  }
}

function saveAddressToLocal(addr) {
  if (!addr) return;

  const list = loadSavedAddresses();

  const exists = list.some(a =>
    a.city   === addr.city &&
    a.street === addr.street &&
    a.house  === addr.house &&
    (a.apt || '') === (addr.apt || '')
  );
  if (exists) return;

  list.push({
    id: Date.now(),
    city: addr.city,
    street: addr.street,
    house: addr.house,
    apt: addr.apt || ''
  });

  localStorage.setItem('bm_addresses', JSON.stringify(list));
}

function openAddressesModal() {
  const modal = document.getElementById('addresses-modal');
  const listEl = document.getElementById('saved-addresses-list');
  if (!modal || !listEl) return;

  const addrs = loadSavedAddresses();

  if (!addrs.length) {
    listEl.innerHTML = `
      <div class="small">
        –ü–æ–∫–∞ –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –∞–¥—Ä–µ—Å–æ–≤. –û—Ñ–æ—Ä–º–∏—Ç–µ –¥–æ—Å—Ç–∞–≤–∫—É ‚Äî –∏ –∞–¥—Ä–µ—Å –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
      </div>
    `;
  } else {
    listEl.innerHTML = '';
    addrs.forEach((addr, idx) => {
      const div = document.createElement('div');
      div.className = 'saved-address-row';

      const line = `${addr.city}, ${addr.street} ${addr.house}${
        addr.apt ? ', –∫–≤. ' + addr.apt : ''
      }`;

      div.innerHTML = `
        <div class="saved-address-row-main">${line}</div>
        <div class="saved-address-row-extra">–î–æ—Å—Ç–∞–≤–∫–∞ –ø–æ —ç—Ç–æ–º—É –∞–¥—Ä–µ—Å—É</div>
        <div style="margin-top:6px">
          <button class="btn-small" data-addr-index="${idx}">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å</button>
        </div>
      `;
      listEl.appendChild(div);
    });
  }

  modal.style.display = 'flex';
  modal.setAttribute('aria-hidden', 'false');
}

// –∑–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–∫–∏ –∞–¥—Ä–µ—Å–æ–≤
document.addEventListener('click', (e) => {
  if (e.target.id === 'addresses-close' || e.target.id === 'addresses-modal') {
    const modal = document.getElementById('addresses-modal');
    if (!modal) return;
    if (e.target.id === 'addresses-modal' && e.target !== modal) return;
    modal.style.display = 'none';
    modal.setAttribute('aria-hidden', 'true');
  }
});

// –∫–ª–∏–∫ –ø–æ "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å" –∞–¥—Ä–µ—Å
document.addEventListener('click', (e) => {
  const btn = e.target.closest('.btn-small[data-addr-index]');
  if (!btn) return;

  const idx = Number(btn.dataset.addrIndex);
  const addrs = loadSavedAddresses();
  const addr = addrs[idx];
  if (!addr) return;

  const cityInput   = document.getElementById('cust-city');
  const streetInput = document.getElementById('cust-street');
  const houseInput  = document.getElementById('cust-house');
  const aptInput    = document.getElementById('cust-apartment');

  if (cityInput)   cityInput.value   = addr.city   || '';
  if (streetInput) streetInput.value = addr.street || '';
  if (houseInput)  houseInput.value  = addr.house  || '';
  if (aptInput)    aptInput.value    = addr.apt    || '';

  // –≤–∫–ª—é—á–∞–µ–º —Ä–µ–∂–∏–º "–¥–æ—Å—Ç–∞–≤–∫–∞"
  if (deliveryModeDelivery) deliveryModeDelivery.checked = true;
  if (deliveryModePickup)   deliveryModePickup.checked   = false;
  updateAddressVisibility();

  // –∑–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É
  const modal = document.getElementById('addresses-modal');
  if (modal) {
    modal.style.display = 'none';
    modal.setAttribute('aria-hidden', 'true');
  }

  // –µ—Å–ª–∏ –µ—Å—Ç—å —Ç–æ–≤–∞—Ä—ã ‚Äî —Å—Ä–∞–∑—É –∫–∏–¥–∞–µ–º –≤ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ
  if (gotoCheckoutBtn && cart.length > 0) {
    gotoCheckoutBtn.click();
  }
});

/* PROFILE PANEL REFS */
const profilePanel = document.getElementById('profile-panel');
const profileCloseBtn = document.getElementById('profile-close');
const profileAvatarEl = document.getElementById('profile-avatar');
const profileNameEl = document.getElementById('profile-name');
const profilePhoneEl = document.getElementById('profile-phone');
const profileLevelEl = document.getElementById('profile-level');
const profilePointsEl = document.getElementById('profile-points');
const profileLoyaltyHintEl = document.getElementById('profile-loyalty-hint');

const profileOrdersBtn = document.getElementById('profile-orders');
const profileAddressesBtn = document.getElementById('profile-addresses');
const profilePaymentsBtn = document.getElementById('profile-payments');
const profileSupportBtn = document.getElementById('profile-support');
const profileLogoutBtn = document.getElementById('profile-logout');

/* ========== CHECKOUT (fullscreen, –∫–∞–∫ –°–∞–º–æ–∫–∞—Ç) ========== */

/* helper: –∫—Ä–∞—Å–∏–≤—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è –≤—Ä–µ–º–µ–Ω–∏ –¥–æ—Å—Ç–∞–≤–∫–∏ */
function describeDeliveryTime(code, customVal) {
  switch (code) {
    case 'asap':
      return '–ö–∞–∫ –º–æ–∂–Ω–æ —Å–∫–æ—Ä–µ–µ (–¥–æ 1 —á–∞—Å–∞)';
    case 'slot_15':
      return '–í —Ç–µ—á–µ–Ω–∏–µ 15 –º–∏–Ω—É—Ç';
    case 'slot_30':
      return '–í —Ç–µ—á–µ–Ω–∏–µ 30 –º–∏–Ω—É—Ç';
    case 'slot_60':
      return '–í —Ç–µ—á–µ–Ω–∏–µ 60 –º–∏–Ω—É—Ç';
    case 'custom':
      if (customVal) {
        return `–ö ${customVal} ¬± 10 –º–∏–Ω—É—Ç`;
      }
      return '–ö –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É –≤—Ä–µ–º–µ–Ω–∏ (—É—Ç–æ—á–Ω–∏—Ç–µ –≤ –ø–æ–ª–µ –≤—Ä–µ–º–µ–Ω–∏)';
    default:
      return '–ö–∞–∫ –º–æ–∂–Ω–æ —Å–∫–æ—Ä–µ–µ (–¥–æ 1 —á–∞—Å–∞)';
  }
}

/* –ø–æ–∫–∞–∑–∞—Ç—å / —Å–∫—Ä—ã—Ç—å –∞–¥—Ä–µ—Å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –¥–æ—Å—Ç–∞–≤–∫–∏ / —Å–∞–º–æ–≤—ã–≤–æ–∑–∞ */
function updateAddressVisibility() {
  const isPickup = deliveryModePickup && deliveryModePickup.checked;

  // –°–∫—Ä—ã–≤–∞–µ–º/–ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–¥—Ä–µ—Å
  if (fieldCity) fieldCity.style.display = isPickup ? 'none' : 'block';
  if (fieldStreet) fieldStreet.style.display = isPickup ? 'none' : 'block';
  if (fieldHouse) fieldHouse.style.display = isPickup ? 'none' : 'block';
  if (fieldApt) fieldApt.style.display = isPickup ? 'none' : 'block';

  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–¥—Ä–µ—Å–∞ —Å–∞–º–æ–≤—ã–≤–æ–∑–∞
  if (pickupInfo) pickupInfo.style.display = isPickup ? 'block' : 'none';

  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—ã–π –±–ª–æ–∫ –≤—Ä–µ–º–µ–Ω–∏
  if (isPickup) {
    pickupTimeSection.style.display = 'block';
    deliveryTimeSelect.closest('.checkout-section').style.display = 'none';
  } else {
    pickupTimeSection.style.display = 'none';
    deliveryTimeSelect.closest('.checkout-section').style.display = 'block';
  }
}

/* –æ—Ç–∫—Ä—ã—Ç–∏–µ checkout –ø—Ä–∏ –∫–ª–∏–∫–µ "–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑" */
if (gotoCheckoutBtn && checkoutOverlay) {
  gotoCheckoutBtn.addEventListener('click', () => {
    if (cart.length === 0) {
      alert('–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞ ‚Äî –¥–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã.');
      return;
    }

    modalOrderList.innerHTML = '';
    let sum = 0;
    cart.forEach(i => {
      const row = document.createElement('div');
      row.className = 'checkout-cart-row';
      row.innerHTML = `
        <div style="display:flex;justify-content:space-between;gap:8px">
          <div>
            <div style="font-weight:700">${i.name}</div>
            <div class="small" style="color:var(--muted)">${displayQty(i.qtyKg)}</div>
          </div>
          <div style="font-weight:700;white-space:nowrap">${formatRub(i.total)}</div>
        </div>
      `;
      modalOrderList.appendChild(row);
      sum += i.total;
    });

    if (modalTotal) {
      modalTotal.textContent = formatRub(sum);
    }

    updateAddressVisibility(); // –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π
    checkoutOverlay.setAttribute('aria-hidden', 'false');
    hideCartPanel();
  });
}

/* –∫–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" –≤ —à–∞–ø–∫–µ checkout */
if (closeModalBtn && checkoutOverlay) {
  closeModalBtn.addEventListener('click', () => {
    checkoutOverlay.setAttribute('aria-hidden', 'true');
    if (!cartPanel.classList.contains('show') && cart.length > 0) {
      setTimeout(() => showFloatingCart(), 120);
    }
  });
}

/* –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –ø–∞–Ω–µ–ª–∏ */
if (checkoutOverlay) {
  checkoutOverlay.addEventListener('click', (e) => {
    if (e.target === checkoutOverlay) {
      checkoutOverlay.setAttribute('aria-hidden', 'true');
      if (!cartPanel.classList.contains('show') && cart.length > 0) {
        setTimeout(() => showFloatingCart(), 120);
      }
    }
  });
}

/* –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –≤—Ä–µ–º–µ–Ω–∏ –¥–æ—Å—Ç–∞–≤–∫–∏ */
if (deliveryTimeSelect) {
  deliveryTimeSelect.addEventListener('change', (e) => {
    const val = e.target.value;

    if (customTimeInput) {
      customTimeInput.style.display = val === 'custom' ? 'block' : 'none';
    }

    const text = describeDeliveryTime(val, customTimeInput ? customTimeInput.value : '');
    if (deliveryTimeHint) deliveryTimeHint.textContent = text;
    if (checkoutTimeDisplay) checkoutTimeDisplay.textContent = text;
  });
}

/* —Ä–µ–∞–≥–∏—Ä—É–µ–º –Ω–∞ –≤–≤–æ–¥ —Ç–æ—á–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ */
if (customTimeInput) {
  customTimeInput.addEventListener('input', () => {
    const val = customTimeInput.value;
    const text = describeDeliveryTime('custom', val);
    if (deliveryTimeHint) deliveryTimeHint.textContent = text;
    if (checkoutTimeDisplay) checkoutTimeDisplay.textContent = text;
  });
}

/* –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –≤—Ä–µ–º–µ–Ω–∏ —Å–∞–º–æ–≤—ã–≤–æ–∑–∞ */
if (pickupTimeSelect) {
  pickupTimeSelect.addEventListener('change', () => {
    const v = pickupTimeSelect.value;

    if (pickupCustomTimeRow)
      pickupCustomTimeRow.style.display = v === 'custom' ? 'block' : 'none';

    if (pickupTimeHint) {
      if (v === 'custom') {
        pickupTimeHint.textContent = "–ö –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É –≤—Ä–µ–º–µ–Ω–∏";
      } else {
        pickupTimeHint.textContent = "–ß–µ—Ä–µ–∑ " + v + " –º–∏–Ω—É—Ç";
      }
    }
  });
}

/* –≤–≤–æ–¥ —Ç–æ—á–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ —Å–∞–º–æ–≤—ã–≤–æ–∑–∞ */
if (pickupCustomTimeInput) {
  pickupCustomTimeInput.addEventListener('input', () => {
    if (pickupTimeHint)
      pickupTimeHint.textContent = "–ö " + pickupCustomTimeInput.value;
  });
}


/* –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å–ø–æ—Å–æ–±–∞ –ø–æ–ª—É—á–µ–Ω–∏—è ‚Äî –¥–æ—Å—Ç–∞–≤–∫–∞ / —Å–∞–º–æ–≤—ã–≤–æ–∑ */
if (deliveryModeDelivery) {
  deliveryModeDelivery.addEventListener('change', () => {
    updateAddressVisibility();
  });
}
if (deliveryModePickup) {
  deliveryModePickup.addEventListener('change', () => {
    updateAddressVisibility();
  });
}
// –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ä–∞–∑—É –ø—Ä–∏–≤–µ—Å—Ç–∏ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
updateAddressVisibility();

/* –æ—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–∫–∞–∑–∞ */
if (checkoutSubmitBtn && checkoutOverlay) {
  checkoutSubmitBtn.addEventListener('click', async () => {

    // ‚õî –ë–ª–æ–∫–∏—Ä—É–µ–º, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤–æ—à—ë–ª
    const user = getUserLocally();
    if (!user) {
      authModal.setAttribute("aria-hidden", "false");
      alert("–ß—Ç–æ–±—ã –æ—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑ ‚Äî –≤–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç.");
      return;
    }

    if (cart.length === 0) {
      alert('–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞!');
      return;
    }

    const isPickup = deliveryModePickup && deliveryModePickup.checked;

    // –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
    const name = document.getElementById('cust-name').value.trim();
    const phone = document.getElementById('cust-phone').value.trim();
    const email = document.getElementById('cust-email').value.trim();
    const payment = document.getElementById('payment-method').value;
    const comment = document.getElementById('cust-comment').value.trim();

    if (!name || !phone) {
      alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∏–º—è –∏ —Ç–µ–ª–µ—Ñ–æ–Ω.");
      return;
    }

    let timeText = "";

    if (isPickup) {
      const v = pickupTimeSelect.value;
      if (v === "custom") {
        const t = pickupCustomTimeInput.value;
        if (!t) {
          alert("–£–∫–∞–∂–∏—Ç–µ —Ç–æ—á–Ω–æ–µ –≤—Ä–µ–º—è —Å–∞–º–æ–≤—ã–≤–æ–∑–∞");
          return;
        }
        timeText = "–ö " + t;
      } else {
        timeText = "–ß–µ—Ä–µ–∑ " + v + " –º–∏–Ω—É—Ç";
      }

    } else {
      const v = deliveryTimeSelect.value;
      if (v === "custom") {
        const t = customTimeInput.value;
        if (!t) {
          alert("–£–∫–∞–∂–∏—Ç–µ —Ç–æ—á–Ω–æ–µ –≤—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏");
          return;
        }
        timeText = "–ö " + t + " ¬± 10 –º–∏–Ω—É—Ç";
      } else {
        timeText = describeDeliveryTime(v, customTimeInput.value);
      }
    }

    // –∞–¥—Ä–µ—Å (—Ç–æ–ª—å–∫–æ –¥–ª—è –¥–æ—Å—Ç–∞–≤–∫–∏)
    let city = "", street = "", house = "", apt = "";

    if (!isPickup) {
      city = document.getElementById('cust-city').value.trim();
      street = document.getElementById('cust-street').value.trim();
      house = document.getElementById('cust-house').value.trim();
      apt = document.getElementById('cust-apartment').value.trim();

      if (!city || !street || !house) {
        alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≥–æ—Ä–æ–¥, —É–ª–∏—Ü—É –∏ –¥–æ–º.");
        return;
      }
    }

    // –ø—É–Ω–∫—Ç —Å–∞–º–æ–≤—ã–≤–æ–∑–∞
    let pickupPoint = null;
    if (isPickup) {
      const selected = document.querySelector('input[name="pickup-point"]:checked');
      if (!selected) {
        alert("–í—ã–±–µ—Ä–∏—Ç–µ –ø—É–Ω–∫—Ç —Å–∞–º–æ–≤—ã–≤–æ–∑–∞.");
        return;
      }
      pickupPoint = selected.value;
    }

    // –∫–æ—Ä–∑–∏–Ω–∞
    const items = cart.map(i => ({
      name: i.name,
      qtyKg: i.qtyKg,
      price: i.price,
      total: i.total
    }));

    const total = cart.reduce((s, i) => s + i.total, 0);

    /* ‚Äî‚Äî‚Äî –°–æ—Ö—Ä–∞–Ω—è–µ–º –∑–∞–∫–∞–∑ –≤ Supabase ‚Äî‚Äî‚Äî */
    const { error: orderError } = await db
  .from("orders")
  .insert([{
    user_id: user.id,          // ‚Üê –¢–ê–ö
    phone: user.phone,         // ‚Üê –¢–ê–ö
    name,
    mode: isPickup ? "pickup" : "delivery",
    pickup_point: pickupPoint,
    city,
    street,
    house,
    apt,
    payment,
    time: timeText,
    comment,
    total,
    items
  }]);


    if (orderError) {
      alert("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞: " + orderError.message);
      return;
    }
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∞–¥—Ä–µ—Å –≤ "–ú–æ–∏ –∞–¥—Ä–µ—Å–∞", –µ—Å–ª–∏ –¥–æ—Å—Ç–∞–≤–∫–∞
    if (!isPickup && city && street && house) {
      saveAddressToLocal({ city, street, house, apt });
    }
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∞–¥—Ä–µ—Å –≤ "–ú–æ–∏ –∞–¥—Ä–µ—Å–∞", –µ—Å–ª–∏ –¥–æ—Å—Ç–∞–≤–∫–∞
    if (!isPickup && city && street && house) {
      saveAddressToLocal({ city, street, house, apt });
    }

    // –ï—Å–ª–∏ –∑–∞–ø—É—â–µ–Ω–æ –≤–Ω—É—Ç—Ä–∏ Telegram WebApp ‚Äî —à–ª—ë–º –∑–∞–∫–∞–∑ –≤ –±–æ—Ç
    if (tg && tg.sendData) {
      try {
        tg.sendData(JSON.stringify({
          type: "order",
          total,
          items,
          mode: isPickup ? "pickup" : "delivery",
          pickupPoint,
          city,
          street,
          house,
          apt,
          timeText,
          payment,
          comment,
          user: {
            id: user.id,
            phone: user.phone,
            name
          }
        }));
      } catch (e) {
        console.error("tg.sendData error:", e);
      }
    }

    await refreshLoyalty();

    alert("–ó–∞–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ –æ—Ñ–æ—Ä–º–ª–µ–Ω! üéâ");

    cart = [];
    renderCart();
    checkoutOverlay.setAttribute("aria-hidden", "true");
  });
}

/* ========== simple user system (localStorage) ========== */
function getStoredUser(){ try { return JSON.parse(localStorage.getItem('bm_user')||'null'); } catch(e){ return null; } }
function storeUser(u){ localStorage.setItem('bm_user', JSON.stringify(u)); }
function clearUser(){ localStorage.removeItem('bm_user'); localStorage.removeItem('bm_loyalty'); updateUserUI(); }

function getLoyalty(){ return parseInt(localStorage.getItem('bm_loyalty')||'0',10); }
function setLoyalty(n){ localStorage.setItem('bm_loyalty', String(n)); updateUserUI(); }
function addLoyalty(n){ const cur = getLoyalty(); setLoyalty(cur + n); }

function logout() {
  // –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–∞–µ–º localStorage
  localStorage.removeItem("bm_user");
  localStorage.removeItem("bm_loyalty");

  // –∑–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫–∏
  if (authModal) authModal.setAttribute("aria-hidden", "true");
  if (checkoutOverlay) checkoutOverlay.setAttribute("aria-hidden", "true");

  const historyModal = document.getElementById("history-modal");
  if (historyModal) historyModal.style.display = "none";

  // –æ–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
  updateUserUI();

  alert("–í—ã –≤—ã—à–ª–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞.");
}

function updateUserUI() {
  const u = getUserLocally();

  if (u) {
    // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–º—è/—Ç–µ–ª–µ—Ñ–æ–Ω, –µ—Å–ª–∏ —Ö–æ—á–µ—à—å ‚Äî –º–æ–∂–Ω–æ —Å–∫—Ä—ã—Ç—å —Ç–µ–∫—Å—Ç —á–µ—Ä–µ–∑ CSS
    if (uaName) {
      uaName.textContent = u.name || u.phone || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
    }

    // –¥–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å "–∑–∞–ª–æ–≥–∏–Ω–µ–Ω" –¥–ª—è –∑–µ–ª—ë–Ω–æ–π —Ç–æ—á–∫–∏
    if (userAreaBtn) {
      userAreaBtn.classList.add('is-logged-in');
    }
  } else {
    if (uaName) {
      uaName.textContent = '–í–æ–π—Ç–∏';
    }
    if (userAreaBtn) {
      userAreaBtn.classList.remove('is-logged-in');
    }
  }
}

function getUserDisplayPhone(user) {
  if (!user) return '';
  if (user.phone) return user.phone;
  if (user.tgUser && user.tgUser.username) {
    return '@' + user.tgUser.username;
  }
  return '';
}

function calcLoyaltyLevel(points) {
  if (points >= 300) return 'Gold';
  if (points >= 150) return 'Silver';
  return '–ë–∞–∑–æ–≤—ã–π';
}

function openProfilePanel() {
  const user = getUserLocally();
  if (!user) {
    // –µ—Å–ª–∏ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω ‚Äî –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–∫–Ω–æ –≤—Ö–æ–¥–∞
    if (authModal) authModal.setAttribute('aria-hidden', 'false');
    return;
  }

  const name = user.name || user.phone || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
  const phone = getUserDisplayPhone(user);
  const points = getLoyalty();
  const level = calcLoyaltyLevel(points);

  if (profileNameEl) profileNameEl.textContent = name;
  if (profilePhoneEl) profilePhoneEl.textContent = phone || '–ë–µ–∑ –Ω–æ–º–µ—Ä–∞';
  if (profileAvatarEl) {
    const first = name.trim()[0] || 'üôÇ';
    profileAvatarEl.textContent = first.toUpperCase();
  }

  if (profilePointsEl) profilePointsEl.textContent = points + ' –±–∞–ª–ª–æ–≤';
  if (profileLevelEl) profileLevelEl.textContent = level;

  if (profileLoyaltyHintEl) {
    if (level === 'Gold') {
      profileLoyaltyHintEl.textContent = 'Gold: –¥–æ 10% —Å–∫–∏–¥–∫–∏ –∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–∫–∞–∑–æ–≤.';
    } else if (level === 'Silver') {
      profileLoyaltyHintEl.textContent = 'Silver: –¥–æ 5% —Å–∫–∏–¥–∫–∏ –∏ –±–æ–Ω—É—Å—ã –∑–∞ –∫–∞–∂–¥—ã–π –∑–∞–∫–∞–∑.';
    } else {
      profileLoyaltyHintEl.textContent = '–ö–æ–ø–∏—Ç–µ –±–∞–ª–ª—ã –∑–∞ –∫–∞–∂–¥—ã–π –∑–∞–∫–∞–∑ –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –Ω–∞ —É—Ä–æ–≤–Ω–∏ Silver –∏ Gold.';
    }
  }

  if (profilePanel) {
    profilePanel.setAttribute('aria-hidden', 'false');
  }
}

/* PROFILE PANEL HANDLERS */

if (profileCloseBtn && profilePanel) {
  profileCloseBtn.addEventListener('click', () => {
    profilePanel.setAttribute('aria-hidden', 'true');
  });

  profilePanel.addEventListener('click', (e) => {
    if (e.target === profilePanel) {
      profilePanel.setAttribute('aria-hidden', 'true');
    }
  });
}
if (profileOrdersBtn) {
  profileOrdersBtn.addEventListener('click', () => {
    // –∑–∞–∫—Ä—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å –õ–ö
    if (profilePanel) {
      profilePanel.setAttribute('aria-hidden', 'true');
    }
    // –æ—Ç–∫—Ä—ã–≤–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –∑–∞–∫–∞–∑–æ–≤ –ø–æ–≤–µ—Ä—Ö –≤—Å–µ–≥–æ
    openHistoryModal();
  });
}

if (profileAddressesBtn) {
  profileAddressesBtn.addEventListener('click', () => {
    // –ø—Ä—è—á–µ–º –õ–ö
    if (profilePanel) {
      profilePanel.setAttribute('aria-hidden', 'true');
    }
    openAddressesModal();
  });
}

if (profilePaymentsBtn) {
  profilePaymentsBtn.addEventListener('click', () => {
    alert('–°–µ–π—á–∞—Å –¥–æ—Å—Ç—É–ø–Ω–∞ –æ–ø–ª–∞—Ç–∞ –Ω–∞–ª–∏—á–Ω—ã–º–∏ –∏–ª–∏ –∫–∞—Ä—Ç–æ–π –∫—É—Ä—å–µ—Ä—É.');
  });
}

if (profileSupportBtn) {
  profileSupportBtn.addEventListener('click', () => {
    const supportLink = 'https://t.me/bravosupport';
    if (typeof tg !== 'undefined' && tg.openTelegramLink) {
      tg.openTelegramLink(supportLink);
    } else {
      window.open(supportLink, '_blank');
    }
  });
}

if (profileLogoutBtn) {
  profileLogoutBtn.addEventListener('click', () => {
    if (confirm('–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞?')) {
      logout();
      profilePanel.setAttribute('aria-hidden', 'true');
    }
  });
}


/* Try to auto-login from Telegram WebApp if available */
function tryTelegramLogin(){
  if(tg && tg.initDataUnsafe && tg.initDataUnsafe.user){
    const tu = tg.initDataUnsafe.user;
    const user = {
      id: 'tg_' + (tu.id||Math.random().toString(36).slice(2,8)),
      name: (tu.first_name || '') + (tu.last_name ? ' '+tu.last_name : ''),
      tgUser: tu
    };
    storeUser(user);
    if(!localStorage.getItem('bm_loyalty')) localStorage.setItem('bm_loyalty','0');
    updateUserUI();
    return true;
  }
  return false;
}

/* ========== helpers ========= */
function idify(s){ return String(s).replace(/\W+/g,'_'); }
function formatRub(v){ return Math.round(v) + ' ‚ÇΩ'; }
function displayQty(kg){ if(kg<1) return Math.round(kg*1000) + ' –≥'; return kg.toFixed(2) + ' –∫–≥'; }
function randInt(max){ return Math.floor(Math.random()*max); }

/* transliteration & slug for images */
function transliterate(str){
  if(!str) return '';
  const map = {'–∞':'a','–±':'b','–≤':'v','–≥':'g','–¥':'d','–µ':'e','—ë':'e','–∂':'zh','–∑':'z','–∏':'i','–π':'y','–∫':'k','–ª':'l','–º':'m','–Ω':'n','–æ':'o','–ø':'p','—Ä':'r','—Å':'s','—Ç':'t','—É':'u','—Ñ':'f','—Ö':'h','—Ü':'ts','—á':'ch','—à':'sh','—â':'shch','—ä':'','—ã':'y','—å':'','—ç':'e','—é':'yu','—è':'ya'};
  return String(str).split('').map(ch=>{
    const lower = ch.toLowerCase();
    if(map[lower] !== undefined) return map[lower];
    if(/[a-z0-9]/i.test(ch)) return ch;
    if(/\s/.test(ch)) return '-';
    return '';
  }).join('');
}
function slugify(name){
  return transliterate(name).toLowerCase()
    .replace(/[^a-z0-9\-]+/g,'-')
    .replace(/^-+|-+$/g,'');
}

function tryLoadImage(imgEl, name){
  if(!imgEl) return;
  const exts = ['.webp','.jpg','.jpeg','.png'];
  const candidates = [];
  const slug = slugify(name || '');
  if(slug){
    exts.forEach(ext => candidates.push('images/' + slug + ext));
  }
  const encoded = encodeURIComponent(name || '');
  if(encoded){
    exts.forEach(ext => candidates.push('images/' + encoded + ext));
  }
  if(name && /^[\x00-\x7F]+$/.test(name)){
    exts.forEach(ext => candidates.push('images/' + name + ext));
  }
  candidates.push('images/noimage.png');

  let idx = 0;
  function tryNext(){
    if(idx >= candidates.length){
      imgEl.src = 'images/noimage.png';
      imgEl.onload = ()=> imgEl.style.opacity = '1';
      return;
    }
    const url = candidates[idx];
    const tester = new Image();
    tester.onload = () => {
      imgEl.src = url;
      imgEl.onload = ()=> imgEl.style.opacity = '1';
    };
    tester.onerror = () => {
      idx++;
      tryNext();
    };
    tester.src = url;
  }
  tryNext();
}

/* getters for both array and object product formats */
function getLabel(it){
  if(!it) return '';
  if(Array.isArray(it)) return it[0]||it[1]||'';
  return it.label||it.name||'';
}
function getName(it){
  if(!it) return '';
  if(Array.isArray(it)) return it[1]||it[0]||'';
  return it.name||it.label||'';
}
function getPrice(it){
  if(!it) return 0;
  if(Array.isArray(it)) return Number(it[2]||0);
  return Number(it.price||0);
}
function getCategory(it){
  if(!it) return '';
  if(Array.isArray(it)) return it[3]||'';
  return it.category||'';
}
function describeDeliveryTime(code, customValue){
  switch (code) {
    case 'asap':
      return '–ö–∞–∫ –º–æ–∂–Ω–æ —Å–∫–æ—Ä–µ–µ (–¥–æ 1 —á–∞—Å–∞)';
    case 'slot_15':
      return '–í —Ç–µ—á–µ–Ω–∏–µ 15 –º–∏–Ω—É—Ç';
    case 'slot_30':
      return '–í —Ç–µ—á–µ–Ω–∏–µ 30 –º–∏–Ω—É—Ç';
    case 'slot_60':
      return '–í —Ç–µ—á–µ–Ω–∏–µ 60 –º–∏–Ω—É—Ç';
    case 'custom':
      if (customValue) {
        return '–ö–æ –≤—Ä–µ–º–µ–Ω–∏ ' + customValue;
      }
      return '–ö–æ –≤—Ä–µ–º–µ–Ω–∏ (–≤—Ä–µ–º—è –Ω–µ —É–∫–∞–∑–∞–Ω–æ)';
    default:
      return '–ö–∞–∫ –º–æ–∂–Ω–æ —Å–∫–æ—Ä–µ–µ';
  }
}

/* ========== renderCatalog ========== */
function renderCatalog(list){
  if(!catalogEl) return;
  catalogEl.innerHTML = '';
  list.forEach((p, idxVisible) => {
    const label = getLabel(p);
    const name = getName(p);
    const price = getPrice(p);
    const category = getCategory(p);

    let globalIdx = products.findIndex(pp =>
      getName(pp) === name &&
      getPrice(pp) === price &&
      String(getCategory(pp)) === String(category)
    );
    if(globalIdx === -1) globalIdx = idxVisible;

    const card = document.createElement('div');
    card.className = 'card fade-in';
    card.dataset.prodName = name;
    card.dataset.prodLabel = label;
    card.dataset.prodPrice = price;

    card.innerHTML = `
      <div class="photo"><img alt="${name}" loading="lazy"></div>
      <div class="info">
        <div class="name">${label}</div>
        <div class="desc">${name}</div>
        <div style="display:flex;align-items:center;justify-content:space-between;margin-top:auto;gap:8px">
          <div class="price">${price} ‚ÇΩ/–∫–≥</div>
          <div class="actions" style="min-width:120px">
            <input class="qty-input" type="number" min="1" step="1" value="1" title="–ö–æ–ª-–≤–æ">
            <select class="unit-select" title="–ï–¥–∏–Ω–∏—Ü–∞">
              <option value="kg">–∫–≥</option>
              <option value="g">–≥—Ä</option>
            </select>
            <button class="add-to-cart" data-idx="${idxVisible}" data-global-idx="${globalIdx}">+</button>
          </div>
        </div>
        <div class="reco small" data-idx="${idxVisible}"></div>
      </div>
    `;
    catalogEl.appendChild(card);

    const img = card.querySelector('img');
    tryLoadImage(img, name);

    const others = products.map((pp,i)=> i !== globalIdx ? pp : null).filter(Boolean);
    const picks = [];
    while(picks.length < 2 && others.length){
      const k = randInt(others.length);
      picks.push(others.splice(k,1)[0]);
    }
    const recoEl = card.querySelector('.reco');
    if(picks.length) recoEl.textContent = '–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º: ' + picks.map(x=>getName(x)).join(', ');
  });
  if(shownCountEl) shownCountEl.textContent = list.length;
}

/* ========== Cart logic ========== */
function addToCart(productObj){
  const existing = cart.find(i =>
    i.name === productObj.name &&
    JSON.stringify(i.components||[]) === JSON.stringify(productObj.components||[])
  );
  if(existing){
    existing.qtyKg += productObj.qtyKg;
    existing.total = existing.qtyKg * existing.price;
  } else {
    cart.push({
      id: idify(productObj.name) + '_' + Math.random().toString(36).slice(2,8),
      name: productObj.name,
      price: productObj.price,
      qtyKg: productObj.qtyKg,
      total: productObj.qtyKg * productObj.price,
      components: productObj.components || null
    });
  }
  renderCart();
}
function removeFromCart(id){
  cart = cart.filter(i => i.id !== id);
  renderCart();
}
function clearCart(){
  cart = [];
  renderCart();
}

function renderCart() {
  if (!cartItemsEl) return;
  cartItemsEl.innerHTML = '';
  let sum = 0;

  cart.forEach(item => {
    // –≤—Å–µ–≥–¥–∞ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º total –æ—Ç qty * price
    item.total = item.qtyKg * item.price;
    sum += item.total;

    const row = document.createElement('div');
    row.className = 'cart-row';
    row.innerHTML = `
      <div class="cart-row-main">
        <div class="cart-row-img">
          <img alt="${item.name}">
        </div>
        <div class="cart-row-info">
          <div class="cart-row-title">
            ${item.name}${item.components ? ' (Custom)' : ''}
          </div>
          <div class="cart-row-meta small">
            ${displayQty(item.qtyKg)} ‚Ä¢ ${formatRub(item.price)} / –∫–≥
          </div>
          <div class="cart-row-qty">
            <button class="cart-qty-btn" data-minus="${item.id}">‚àí</button>
            <span class="cart-qty-value">${displayQty(item.qtyKg)}</span>
            <button class="cart-qty-btn" data-plus="${item.id}">+</button>
          </div>
        </div>
      </div>

      <div class="cart-row-right">
        <button class="cart-row-remove" data-remove="${item.id}">‚úï</button>
        <div class="cart-row-price">${formatRub(item.total)}</div>
      </div>
    `;

    const imgEl = row.querySelector('img');
    if (imgEl) {
      tryLoadImage(imgEl, item.name);
    }

    cartItemsEl.appendChild(row);
  });

  if (cartSumEl) cartSumEl.textContent = formatRub(sum);
  if (cartCountSmall) cartCountSmall.textContent = cart.length;
  if (fcCountEl) fcCountEl.textContent = cart.length + ' –ø–æ–∑.';
  if (fcTotalEl) fcTotalEl.textContent = formatRub(sum);

  if (cart.length > 0) {
    showFloatingCart();
    document.body.classList.add('cart-has-items');
  } else {
    hideFloatingCart();
    document.body.classList.remove('cart-has-items');
  }

  // —É–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä
  cartItemsEl.querySelectorAll('[data-remove]').forEach(btn => {
    btn.onclick = () => removeFromCart(btn.dataset.remove);
  });

  // –ø–ª—é—Å
  cartItemsEl.querySelectorAll('[data-plus]').forEach(btn => {
    btn.onclick = () => {
      const item = cart.find(i => i.id === btn.dataset.plus);
      if (!item) return;
      item.qtyKg += 1;          // —à–∞–≥ 1 –∫–≥; –º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ 0.5 –µ—Å–ª–∏ —Ö–æ—á–µ—à—å
      renderCart();
    };
  });

  // –º–∏–Ω—É—Å
  cartItemsEl.querySelectorAll('[data-minus]').forEach(btn => {
    btn.onclick = () => {
      const item = cart.find(i => i.id === btn.dataset.minus);
      if (!item) return;
      item.qtyKg -= 1;
      if (item.qtyKg <= 0) {
        cart = cart.filter(i => i.id !== item.id);
      }
      renderCart();
    };
  });
}
function renderCartSuggestions() {
  if (!cartSuggestList) return;
  cartSuggestList.innerHTML = '';

  if (!Array.isArray(products) || products.length === 0) return;

  if (!cart.length) {
    // –µ—Å–ª–∏ –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞—è ‚Äî –ø—Ä–æ—Å—Ç–æ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º
    return;
  }

  // 1) —Å—á–∏—Ç–∞–µ–º, –∫–∞–∫–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å–µ–π—á–∞—Å —á–∞—â–µ –≤—Å–µ–≥–æ –≤ –∫–æ—Ä–∑–∏–Ω–µ
  const countsByCategory = {};
  cart.forEach(item => {
    const prod = products.find(p => getName(p) === item.name);
    if (!prod) return;
    const cat = String(getCategory(prod) || 'other');
    countsByCategory[cat] = (countsByCategory[cat] || 0) + item.qtyKg;
  });

  // 2) –≤—ã–±–∏—Ä–∞–µ–º "—Ç–æ–ø-–∫–∞—Ç–µ–≥–æ—Ä–∏—é"
  const topCategory = Object.entries(countsByCategory)
    .sort((a, b) => b[1] - a[1])[0]?.[0];

  // 3) —Ç–æ–≤–∞—Ä—ã, –∫–æ—Ç–æ—Ä—ã—Ö –µ—â—ë –Ω–µ—Ç –≤ –∫–æ—Ä–∑–∏–Ω–µ
  const inCartNames = new Set(cart.map(i => i.name));

  let candidates;
  if (topCategory) {
    // —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É–µ–º —Ç–æ–≤–∞—Ä—ã –∏–∑ —Ç–æ–π –∂–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    candidates = products.filter(p =>
      String(getCategory(p)) === String(topCategory) &&
      !inCartNames.has(getName(p))
    );
  }
  // –µ—Å–ª–∏ –≤–¥—Ä—É–≥ –Ω–µ —Ö–≤–∞—Ç–∏–ª–æ ‚Äî –¥–æ–±–∏–≤–∞–µ–º –ª—é–±—ã–º–∏ –¥—Ä—É–≥–∏–º–∏ —Ç–æ–≤–∞—Ä–∞–º–∏
  if (!candidates || !candidates.length) {
    candidates = products.filter(p => !inCartNames.has(getName(p)));
  }

  // –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º, –Ω–∞–ø—Ä–∏–º–µ—Ä, 6 —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏
  const picks = candidates.slice(0, 6);

  picks.forEach(p => {
    const card = document.createElement('button');
    card.type = 'button';
    card.className = 'cart-suggest-item';
    card.innerHTML = `
      <div class="cart-suggest-img">
        <img alt="${getName(p)}">
      </div>
      <div class="cart-suggest-info">
        <div class="cart-suggest-name">${getName(p)}</div>
        <div class="cart-suggest-meta small">
          ${getLabel(p)} ‚Ä¢ ${formatRub(getPrice(p))} / –∫–≥
        </div>
      </div>
      <div class="cart-suggest-price">${formatRub(getPrice(p))}</div>
    `;

    const imgEl = card.querySelector('img');
    if (imgEl) tryLoadImage(imgEl, getName(p));

    // –∫–ª–∏–∫ –ø–æ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ ‚Äî —Å—Ä–∞–∑—É –¥–æ–±–∞–≤–ª—è–µ–º 0.5 –∫–≥ (–ø—Ä–∏–º–µ—Ä)
    card.addEventListener('click', () => {
      addToCart({
        name: getName(p),
        price: getPrice(p),
        qtyKg: 0.5
      });
      renderCart();
      renderCartSuggestions();
    });

    cartSuggestList.appendChild(card);
  });
}
/* floating cart helpers */
function showFloatingCart(){
  if(!floatingCart) return;
  floatingCart.classList.add('visible');
}
function hideFloatingCart(){
  if(!floatingCart) return;
  floatingCart.classList.remove('visible');
}
/* cart fullscreen panel helpers */
function showCartPanel() {
  if (!cartPanel) return;
  cartPanel.classList.add('show');
  cartPanel.setAttribute('aria-hidden', 'false');
  document.body.style.overflow = 'hidden';
}

function hideCartPanel() {
  if (!cartPanel) return;
  cartPanel.classList.remove('show');
  cartPanel.setAttribute('aria-hidden', 'true');
  document.body.style.overflow = '';
}

/* ========== Delegation: add to cart from catalog ========== */
document.addEventListener('click', (e) => {
  const btn = e.target.closest('.add-to-cart');
  if (!btn) return;

  const idxVisible = +btn.dataset.idx;
  const idxGlobal = btn.dataset.globalIdx !== undefined
    ? +btn.dataset.globalIdx
    : null;

  const card = btn.closest('.card');
  if (!card) return; // –∑–∞—â–∏—Ç–∞ –æ—Ç null

  const qtyInput = card.querySelector('.qty-input');
  const unitSelect = card.querySelector('.unit-select');
  if (!qtyInput || !unitSelect) return; // –µ—â—ë –∑–∞—â–∏—Ç–∞

  const qty = parseFloat(qtyInput.value) || 0;
  const unit = unitSelect.value;

  let qtyKg = unit === 'g' ? qty / 1000 : qty;
  if (qtyKg <= 0) {
    alert('–£–∫–∞–∂–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ');
    return;
  }

  const source =
    (visibleProducts && visibleProducts[idxVisible]) ||
    products[idxGlobal] ||
    products[idxVisible];

  const name = getName(source);
  const price = getPrice(source);

  addToCart({ name, price, qtyKg });

  // –∞–Ω–∏–º–∞—Ü–∏—è –≥–∞–ª–æ—á–∫–∏
  const ck = document.createElement('div');
  ck.className = 'checkmark';
  ck.textContent = '‚úì';

  card.style.position = 'relative';
  ck.style.position = 'absolute';
  ck.style.right = '8px';
  ck.style.top = '8px';
  ck.style.background = 'rgba(0,0,0,0.7)';
  ck.style.color = '#fff';
  ck.style.borderRadius = '999px';
  ck.style.width = '22px';
  ck.style.height = '22px';
  ck.style.display = 'flex';
  ck.style.alignItems = 'center';
  ck.style.justifyContent = 'center';
  ck.style.fontSize = '14px';
  ck.style.opacity = '0';
  ck.style.transform = 'scale(.6)';
  ck.style.transition = 'all .25s ease';

  card.appendChild(ck);
  setTimeout(() => {
    ck.style.opacity = '1';
    ck.style.transform = 'scale(1)';
  }, 10);
  setTimeout(() => {
    ck.style.opacity = '0';
    ck.style.transform = 'scale(.6)';
  }, 900);
  setTimeout(() => {
    ck.remove();
  }, 1200);
});

/* catalog card click -> open product modal (ignore clicks on interactive elements) */
catalogEl.addEventListener('click', (e) => {
  const card = e.target.closest('.card');
  if(!card) return;
  if(e.target.closest('.add-to-cart') || e.target.closest('.qty-input') || e.target.closest('.unit-select')) return;
  const pname = card.dataset.prodName;
  const plabel = card.dataset.prodLabel;
  const pprice = card.dataset.prodPrice;

  pmName.textContent = plabel || pname;
  pmPrice.textContent = pprice ? (pprice + ' ‚ÇΩ/–∫–≥') : '';
  const info = kbjuData[pname];
  if(info){
    pmKbju.textContent = info.kbju;
    pmDesc.textContent = info.desc;
  } else {
    pmKbju.textContent = '–ö–ë–ñ–£ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ';
    pmDesc.textContent = '–û–ø–∏—Å–∞–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ';
  }
  pmDesc.style.display = 'none';
  pmMore.textContent = '–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ —Ç–æ–≤–∞—Ä–µ';

  tryLoadImage(pmImg, pname);

  pmQty.value = 1;
  pmUnit.value = 'kg';

  productModal.style.display = 'flex';
  productModal.setAttribute('aria-hidden','false');
});

/* product modal interactions */
pmMore.addEventListener('click', () => {
  if(pmDesc.style.display === 'none'){
    pmDesc.style.display = 'block';
    pmMore.textContent = '–°–≤–µ—Ä–Ω—É—Ç—å';
  } else {
    pmDesc.style.display = 'none';
    pmMore.textContent = '–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ —Ç–æ–≤–∞—Ä–µ';
  }
});
pmClose.addEventListener('click', () => {
  productModal.style.display = 'none';
  productModal.setAttribute('aria-hidden','true');
});
productModal.addEventListener('click', (e) => {
  if(e.target === productModal){
    productModal.style.display = 'none';
    productModal.setAttribute('aria-hidden','true');
  }
});

/* add to cart from modal */
pmAdd.addEventListener('click', () => {
  const name = pmName.textContent || '';
  const priceText = pmPrice.textContent || '';
  const price = Number((priceText.match(/([\d\.]+)/) || [0,0])[1]) || 0;
  const qtyRaw = parseFloat(pmQty.value) || 0;
  const unit = pmUnit.value;
  let qtyKg = unit === 'g' ? qtyRaw/1000 : qtyRaw;
  if(qtyKg <= 0){ alert('–£–∫–∞–∂–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ'); return; }

  addToCart({ name, price, qtyKg });

  productModal.style.display = 'none';
  productModal.setAttribute('aria-hidden','true');
});

/* floating cart => –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–∞—è –∫–æ—Ä–∑–∏–Ω–∞ */
if (floatingCart) {
  floatingCart.addEventListener('click', () => {
    if (cart.length === 0) {
      alert('–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞ ‚Äî –¥–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã.');
      return;
    }

    renderCart();
    if (typeof renderCartSuggestions === 'function') {
      renderCartSuggestions();
    }

    showCartPanel();
    hideFloatingCart();
  });
}
/* –∑–∞–∫—Ä—ã—Ç–∏–µ –æ–∫–Ω–∞ –∫–æ—Ä–∑–∏–Ω—ã */
if (cartCloseBtn && cartPanel) {
  cartCloseBtn.addEventListener('click', () => {
    hideCartPanel();
    if (cart.length > 0) {
      showFloatingCart();
    }
  });

  cartPanel.addEventListener('click', (e) => {
    if (e.target === cartPanel) {
      hideCartPanel();
      if (cart.length > 0) {
        showFloatingCart();
      }
    }
  });
}

function openCategoryPage(filter, title) {
  currentFilter = filter || 'all';

  // –ü–æ–¥—Å–≤–µ—Ç–∏–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–∞—Ä—Ç–æ—á–∫—É –Ω–∞ –≥–ª–∞–≤–Ω–æ–π (–µ—Å–ª–∏ –µ—Å—Ç—å)
  const btn = document.querySelector(
    `#filters .filter-btn[data-filter="${currentFilter}"]`
  );
  if (btn) {
    document.querySelectorAll('#filters .filter-btn').forEach(x =>
      x.classList.toggle('active', x === btn)
    );
    if (!title) {
      const nm = btn.querySelector('.category-name');
      if (nm) title = nm.textContent.trim();
    }
  }

  if (!title) title = '–ö–∞—Ç–µ–≥–æ—Ä–∏—è';
  if (categoryPageTitle) categoryPageTitle.textContent = title;

  // –æ—á–∏—Å—Ç–∏–º —Ç–µ–∫—Å—Ç –ø–æ–∏—Å–∫–∞, —á—Ç–æ–±—ã –Ω–µ –º–µ—à–∞–ª —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
  if (searchInput) searchInput.value = '';
  if (mobileSearchInput) mobileSearchInput.value = '';

  // –æ—Ç—Ñ–∏–ª—å—Ç—Ä—É–µ–º –∏ –æ—Ç—Ä–∏—Å—É–µ–º —Ç–æ–≤–∞—Ä—ã –≤ #catalog
  applySearchAndSort();

  // –ø–æ–∫–∞–∂–µ–º —ç–∫—Ä–∞–Ω –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  if (categoryPanel) {
    categoryPanel.classList.add('open');
    categoryPanel.setAttribute('aria-hidden', 'false');
  }
  document.body.style.overflow = 'hidden';
}

function closeCategoryPage() {
  if (!categoryPanel) return;
  categoryPanel.classList.remove('open');
  categoryPanel.setAttribute('aria-hidden', 'true');
  document.body.style.overflow = '';
}
if (categoryBackBtn) {
  categoryBackBtn.addEventListener('click', closeCategoryPage);
}

if (categoryPanel) {
  categoryPanel.addEventListener('click', (e) => {
    if (e.target === categoryPanel) {
      closeCategoryPage();
    }
  });
}

/* ========== Filters / Search / Sort ========== */
function applySearchAndSort(){
  const q = (searchInput && searchInput.value || '').trim().toLowerCase();
  let list;

// –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω —Å–ø–µ—Ü-–±–ª–æ–∫ (specialFilters)
if (currentFilter && specialFilters[currentFilter]) {
  list = products.filter(p => specialFilters[currentFilter](p));
} else if (currentFilter === 'all' || !currentFilter) {
  list = products.slice();
} else {
  list = products.filter(
    p => String(getCategory(p)) === String(currentFilter)
  );
}
  if(q){
    list = list.filter(p =>
      ( (getLabel(p) + ' ' + getName(p)).toLowerCase().indexOf(q) !== -1 )
    );
  }
  const s = (sortSelect && sortSelect.value) || 'default';
  if(s === 'price_asc') list.sort((a,b)=> getPrice(a) - getPrice(b));
  else if(s === 'price_desc') list.sort((a,b)=> getPrice(b) - getPrice(a));
  else if(s === 'name_asc') list.sort((a,b)=> String(getName(a)).localeCompare(String(getName(b)),'ru'));
  else if(s === 'name_desc') list.sort((a,b)=> String(getName(b)).localeCompare(String(getName(a)),'ru'));
  visibleProducts = list;
  renderCatalog(visibleProducts);
}

if (filtersWrap) {
  filtersWrap.addEventListener('click', (e) => {
    const b = e.target.closest('.filter-btn');
    if (!b) return;

    const f = b.dataset.filter || 'all';
    const title =
      (b.querySelector('.category-name')?.textContent || '').trim();

    openCategoryPage(f, title);
  });
}
// –∫–ª–∏–∫–∞–µ–º –ø–æ —Å–ø–µ—Ü-–∫–∞—Ä—Ç–æ—á–∫–∞–º ("–í—ã–≥–æ–¥–Ω–æ", "–°–µ–∑–æ–Ω–Ω—ã–µ", "–•–∏—Ç—ã", "–ü–æ–¥ –∑–∞–∫–∞–∑")
document.querySelectorAll('.special-card[data-special]').forEach(card => {
  card.addEventListener('click', () => {
    const filter = card.dataset.special;
    const title =
      (card.querySelector('.special-title')?.textContent || '').trim();

    openCategoryPage(filter, title);   // –∏—Å–ø–æ–ª—å–∑—É–µ–º —É–∂–µ –≥–æ—Ç–æ–≤—É—é –ª–æ–≥–∏–∫—É —ç–∫—Ä–∞–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  });
});

if(searchInput) searchInput.addEventListener('input', ()=> applySearchAndSort());
if(sortSelect) sortSelect.addEventListener('change', ()=> applySearchAndSort());

/* ========== mobile search wiring ‚Äî –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π –ø–æ–∏—Å–∫ ========== */
/* –æ—Ç–∫—Ä—ã—Ç–∏–µ/–∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ */
if (fabOpen) {
  fabOpen.addEventListener('click', () => {
    if (!searchPanel) return;

    const wasOpen = searchPanel.classList.contains('open');

    if (!wasOpen) {
      // –û–¢–ö–†–´–í–ê–ï–ú "—Å—Ç—Ä–∞–Ω–∏—Ü—É"
      searchPanel.classList.add('open');
      searchPanel.setAttribute('aria-hidden', 'false');
      document.body.style.overflow = 'hidden';  // –±–ª–æ–∫–∏—Ä—É–µ–º —Ñ–æ–Ω

      if (mobileSearchInput) {
        mobileSearchInput.focus();
      }
    } else {
      // –ó–ê–ö–†–´–í–ê–ï–ú
      searchPanel.classList.remove('open');
      searchPanel.setAttribute('aria-hidden', 'true');
      document.body.style.overflow = '';        // –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–∫—Ä–æ–ª–ª —Ñ–æ–Ω—É

      if (mobileSearchInput) mobileSearchInput.value = '';
      if (searchInput) searchInput.value = '';
      applySearchAndSort();
    }
  });
}

if (closeSearchPanelBtn) {
  closeSearchPanelBtn.addEventListener('click', () => {
    if (!searchPanel) return;

    searchPanel.classList.remove('open');
    searchPanel.setAttribute('aria-hidden', 'true');
    document.body.style.overflow = '';          // –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–∫—Ä–æ–ª–ª —Ñ–æ–Ω—É

    if (mobileSearchInput) mobileSearchInput.value = '';
    if (searchInput) searchInput.value = '';
    applySearchAndSort();
  });
}

/* –≤–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞ –≤ –ø–æ–ª–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø–æ–∏—Å–∫–∞ */
if (mobileSearchInput) {
  mobileSearchInput.addEventListener('input', () => {
    if (searchInput) searchInput.value = mobileSearchInput.value;
    applySearchAndSort();
  });
}
// live-–ø–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ —Ç–æ–≤–∞—Ä–∞–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø–æ–∏—Å–∫–∞
const liveSugList = document.getElementById('search-suggestions-list');

function updateLiveSuggestions() {
  if (!liveSugList || !mobileSearchInput) return;

  const q = mobileSearchInput.value.trim().toLowerCase();
  liveSugList.innerHTML = '';

  if (!q) {
    liveSugList.classList.remove('show');
    return;
  }

  // –∏—â–µ–º –¥–æ 6 —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é/–ª–µ–π–±–ª—É
  const matches = products
    .filter(p => (getLabel(p) + ' ' + getName(p))
      .toLowerCase()
      .includes(q))
    .slice(0, 6);

  if (!matches.length) {
    liveSugList.classList.remove('show');
    return;
  }

  matches.forEach(p => {
    const el = document.createElement('button');
    el.type = 'button';
    el.className = 'live-suggestion-item';
    el.innerHTML = `
      <span class="live-suggestion-name">${getName(p)}</span>
      <span class="live-suggestion-price">${formatRub(getPrice(p))} / –∫–≥</span>
    `;
    el.addEventListener('click', () => {
      // –∑–∞–∫—Ä—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å –ø–æ–∏—Å–∫–∞
      if (searchPanel) {
        searchPanel.classList.remove('open');
        searchPanel.setAttribute('aria-hidden', 'true');
      }
      document.body.style.overflow = '';

      // —á–∏—Å—Ç–∏–º —Ç–µ–∫—Å—Ç –ø–æ–∏—Å–∫–∞
      mobileSearchInput.value = '';
      if (searchInput) searchInput.value = '';

      // –æ—Ç–∫—Ä—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å —Ñ–∏–ª—å—Ç—Ä–æ–º "all"
      openCategoryPage('all', '–í—Å–µ —Ç–æ–≤–∞—Ä—ã');

      // –∏ —Å—Ä–∞–∑—É —Å—Ç–∞–≤–∏–º —Ç–µ–∫—Å—Ç –≤ –æ–±—ã—á–Ω—ã–π –ø–æ–∏—Å–∫ + —Ñ–∏–ª—å—Ç—Ä—É–µ–º
      if (searchInput) {
        searchInput.value = getName(p);
        applySearchAndSort();
      }
    });

    liveSugList.appendChild(el);
  });

  liveSugList.classList.add('show');
}

// –ø—Ä–∏–≤—è–∑—ã–≤–∞–µ–º –∫ –≤–≤–æ–¥—É
if (mobileSearchInput) {
  mobileSearchInput.addEventListener('input', updateLiveSuggestions);
}

/* —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É —á–µ—Ä–µ–∑ mobileSort –º–æ–∂–Ω–æ –Ω–µ —Ç—Ä–æ–≥–∞—Ç—å ‚Äî —ç–ª–µ–º–µ–Ω—Ç–∞ —Ç–µ–ø–µ—Ä—å –Ω–µ—Ç,
   –Ω–æ –∫–æ–¥ –∑–∞—â–∏—â—ë–Ω –ø—Ä–æ–≤–µ—Ä–∫–æ–π if(mobileSort){...} */

/* –∫–ª–∏–∫ –ø–æ –≥–æ—Ç–æ–≤—ã–º –ø–æ–¥–±–æ—Ä–∫–∞–º –≤ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–º –ø–æ–∏—Å–∫–µ */
document.addEventListener('click', (e) => {
  const sugg = e.target.closest('.search-suggest');
  if (!sugg) return;

  const f = sugg.dataset.filter || 'all';
  const title =
    (sugg.querySelector('.ss-text')?.textContent || '').trim();

  // –∑–∞–∫—Ä—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ–∏—Å–∫–∞
  if (searchPanel) {
    searchPanel.classList.remove('open');
    searchPanel.setAttribute('aria-hidden', 'true');
  }
  document.body.style.overflow = '';

  // –æ—á–∏—â–∞–µ–º –ø–æ–∏—Å–∫–æ–≤—É—é —Å—Ç—Ä–æ–∫—É
  if (mobileSearchInput) mobileSearchInput.value = '';
  if (searchInput) searchInput.value = '';

  // –∏ –æ—Ç–∫—Ä—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  openCategoryPage(f, title);
});

/* ========== Checkout / order sending ========== */
function sendOrderToAdmin(payload){
  if(!ADMIN_WEBHOOK_URL){
    console.log('ADMIN WEBHOOK not set ‚Äî order payload:', payload);
    return Promise.resolve({ ok: false, reason: 'no_webhook' });
  }
  return fetch(ADMIN_WEBHOOK_URL, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(payload)
  }).then(r=>r.json()).catch(err => {
    console.error('sendOrderToAdmin error', err);
    return { ok:false, error: String(err) };
  });
}

if (closeModalBtn) closeModalBtn.addEventListener('click', () => {
  checkoutOverlay.setAttribute('aria-hidden', 'true');
  if (!cartPanel.classList.contains('show') && cart.length > 0) {
    setTimeout(() => showFloatingCart(), 120);
  }
});

// –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –ø–∞–Ω–µ–ª–∏
checkoutOverlay.addEventListener('click', (e) => {
  if (e.target === checkoutOverlay) {
    checkoutOverlay.setAttribute('aria-hidden', 'true');
    if (!cartPanel.classList.contains('show') && cart.length > 0) {
      setTimeout(() => showFloatingCart(), 120);
    }
  }
});

// –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å–ø–æ—Å–æ–±–∞ –ø–æ–ª—É—á–µ–Ω–∏—è ‚Äî –¥–æ—Å—Ç–∞–≤–∫–∞ / —Å–∞–º–æ–≤—ã–≤–æ–∑
if (deliveryModeDelivery) {
  deliveryModeDelivery.addEventListener('change', () => {
    pickupInfo.style.display = 'none';
  });
}

if (deliveryModePickup) {
  deliveryModePickup.addEventListener('change', () => {
    pickupInfo.style.display = 'block';
  });
}

/* hero buttons */
if (heroOrderBtn) {
  heroOrderBtn.addEventListener('click', () => {
    const main = document.querySelector('.main');
    if (main) {
      window.scrollTo({
        top: main.offsetTop - 20,
        behavior: 'smooth'
      });
    }
  });
}

if (viewCatalogBtn) {
  viewCatalogBtn.addEventListener('click', () => {
    openCategoryPage('all', '–í—Å–µ —Ç–æ–≤–∞—Ä—ã');
  });
}
function openAiPanel() {
  if (!aiPanel) return;
  aiPanel.setAttribute('aria-hidden', 'false');
}

function closeAiPanel() {
  if (!aiPanel) return;
  aiPanel.setAttribute('aria-hidden', 'true');
}

function addAiMessage(text, from) {
  if (!aiMessages) return;
  const div = document.createElement('div');
  div.className = 'ai-msg ' + (from === 'user' ? 'ai-msg-user' : 'ai-msg-bot');
  div.textContent = text;
  aiMessages.appendChild(div);
  aiMessages.scrollTop = aiMessages.scrollHeight;
}

function getLocalAiReply(text) {
  const q = text.toLowerCase();

  if (q.includes('–≥–æ—Å—Ç') || q.includes('–≤–µ—á–µ—Ä–∏–Ω')) {
    return '–î–ª—è –≥–æ—Å—Ç–µ–π –º–æ–≥—É —Å–æ–±—Ä–∞—Ç—å: —Ñ—Ä—É–∫—Ç—ã —Ç–∞—Ä–µ–ª–∫–æ–π, –∑–∞–∫—É—Å–∫–∏, –Ω–∞–ø–∏—Ç–∫–∏ –∏ —á—Ç–æ-–Ω–∏–±—É–¥—å –∫ —á–∞—é. –ù–∞–ø–∏—à–∏, —Å–∫–æ–ª—å–∫–æ —á–µ–ª–æ–≤–µ–∫ –∏ –±—é–¥–∂–µ—Ç.';
  }
  if (q.includes('—Ñ–∏–ª—å–º') || q.includes('–∫–∏–Ω–æ')) {
    return '–ü–æ–¥ —Ñ–∏–ª—å–º –∑–∞–π–¥—É—Ç —Å–Ω–µ–∫–∏, —Å–ª–∞–¥–æ—Å—Ç–∏, —Ñ—Ä—É–∫—Ç—ã –±–µ–∑ –∫–æ—Å—Ç–æ—á–µ–∫ –∏ –≥–∞–∑–∏—Ä–æ–≤–∫–∏. –•–æ—á–µ—à—å —á—Ç–æ-—Ç–æ –ø–æ–ª–µ–≥—á–µ –∏–ª–∏ –ø–æ—Ñ–∞—Å—Ç—Ñ—É–¥–Ω–æ–º—É?';
  }
  if (q.includes('–∑–∞–≤—Ç—Ä–∞–∫')) {
    return '–î–ª—è –∑–∞–≤—Ç—Ä–∞–∫–∞ –ø—Ä–µ–¥–ª–∞–≥–∞—é: —Ñ—Ä—É–∫—Ç—ã, —Å–æ–∫–∏, —á–∞–π/–∫–æ—Ñ–µ, –∫—Ä—É–ø—ã –∏ —Å–ª–∞–¥–æ—Å—Ç–∏ –∫ —á–∞—é. –ù–∞–ø–∏—à–∏, —Ö–æ—á–µ—à—å –ü–ü –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –≤–∫—É—Å–Ω–æ.';
  }
  if (q.includes('–∫–±–∂—É') || q.includes('–¥–∏–µ—Ç') || q.includes('–ø–ø')) {
    return '–ú–æ–≥—É –ø–æ–¥—Å–∫–∞–∑–∞—Ç—å –±–æ–ª–µ–µ –ª—ë–≥–∫–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –ø–æ –ö–ë–ñ–£: —Ü–∏—Ç—Ä—É—Å—ã, —è–≥–æ–¥—ã, –æ–≤–æ—â–∏, –≤–æ–¥–∞/—Å–æ–∫–∏ –±–µ–∑ —Å–∞—Ö–∞—Ä–∞. –ù–∞–ø–∏—à–∏ —Å–≤–æ–∏ —Ü–µ–ª–∏ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è.';
  }
  if (q.includes('–≤—ã–≥–æ–¥–Ω') || q.includes('–∞–∫—Ü–∏')) {
    return '–ó–∞ –≤—ã–≥–æ–¥–æ–π –∑–∞–≥–ª—è–Ω–∏ –≤ –±–ª–æ–∫ ¬´–í—ã–≥–æ–¥–Ω–æ —Å–µ–≥–æ–¥–Ω—è¬ª –∏ ¬´–•–∏—Ç—ã –ø—Ä–æ–¥–∞–∂¬ª ‚Äî —Ç–∞–º —Å–∞–º—ã–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ —Ü–µ–Ω—ã. –ú–æ–≥—É –ø–æ–¥—Å–∫–∞–∑–∞—Ç—å –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º.';
  }

  return '–ü–æ–Ω—è–ª –∑–∞–ø—Ä–æ—Å üëå –°–µ–π—á–∞—Å –ò–ò —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ç–µ—Å—Ç–æ–≤–æ–º —Ä–µ–∂–∏–º–µ. –ù–∞–ø–∏—à–∏, –¥–ª—è —á–µ–≥–æ —Å–æ–±–∏—Ä–∞–µ—à—å –∑–∞–∫–∞–∑ (–≥–æ—Å—Ç–∏, —Ñ–∏–ª—å–º, –∑–∞–≤—Ç—Ä–∞–∫, –ü–ü), —è –ø–æ–¥—Å–∫–∞–∂—É –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.';
}

async function loadOrderHistory() {
  const user = getUserLocally();
  if (!user?.id) return [];

  const { data, error } = await db
    .from("orders")
    .select("*")
    .eq("user_id", user.id)
    .order("created_at", { ascending: false });

  if (error) {
    console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–∫–∞–∑–æ–≤:", error);
    return [];
  }
  return data;
}

async function openHistoryModal() {
  const modal = document.getElementById("history-modal");
  const list = document.getElementById("history-list");

  list.innerHTML = "<div class='small'>–ó–∞–≥—Ä—É–∑–∫–∞...</div>";

  const orders = await loadOrderHistory();

  if (!orders.length) {
    list.innerHTML = "<div class='small'>–£ –≤–∞—Å –µ—â—ë –Ω–µ—Ç –∑–∞–∫–∞–∑–æ–≤.</div>";
  } else {
    list.innerHTML = "";

    orders.forEach(order => {
      const div = document.createElement("div");
      div.style.border = "1px solid #eee";
      div.style.padding = "12px";
      div.style.borderRadius = "10px";
      div.style.background = "#fafafa";

      const date = new Date(order.created_at).toLocaleString("ru-RU");

      div.innerHTML = `
        <div style="font-weight:700;margin-bottom:6px">
          –ó–∞–∫–∞–∑ –Ω–∞ —Å—É–º–º—É ${order.total} ‚ÇΩ
        </div>
        <div class="small" style="margin-bottom:6px;color:#777">
          ${date}
        </div>
        <div class="small" style="margin-bottom:6px;color:#555">
          ${order.mode === "pickup" 
             ? "–°–∞–º–æ–≤—ã–≤–æ–∑: " + (order.pickup_point || "‚Äî")
             : "–ê–¥—Ä–µ—Å: " + order.city + ", " + order.street + " " + order.house}
        </div>
        <details>
          <summary style="cursor:pointer;color:#34C48B;font-weight:600">–°–æ—Å—Ç–∞–≤ –∑–∞–∫–∞–∑–∞</summary>
          <div style="margin-top:6px">
            ${order.items
              .map(
                item =>
                  `<div class="small">${item.name} ‚Äî ${item.qtyKg} –∫–≥ ‚Äî ${item.total} ‚ÇΩ</div>`
              )
              .join("")}
          </div>
        </details>
      `;

      list.appendChild(div);
    });
  }

  modal.style.display = "flex";
  modal.setAttribute("aria-hidden", "false");
}

document.getElementById("history-close").addEventListener("click", () => {
  const modal = document.getElementById("history-modal");
  modal.style.display = "none";
  modal.setAttribute("aria-hidden", "true");
});

document.getElementById("history-modal").addEventListener("click", (e) => {
  if (e.target.id === "history-modal") {
    e.target.style.display = "none";
    e.target.setAttribute("aria-hidden", "true");
  }
});

async function refreshLoyalty() {
  const user = getUserLocally();
  if (!user?.id) return;

  const { data } = await db
    .from("customers")
    .select("loyalty_points")
    .eq("id", user.id)
    .single();

  if (data) {
    localStorage.setItem("bm_loyalty", data.loyalty_points);
    updateUserUI();
  }
}
// ===== HERO –°–õ–ê–ô–î–ï–† =====
let heroCurrent = 0;
let heroTimer = null;

function setHeroSlide(index) {
  if (!heroSlides.length) return;

  heroCurrent = (index + heroSlides.length) % heroSlides.length;

  heroSlides.forEach((slide, i) => {
    const isActive = i === heroCurrent;
    slide.classList.toggle('is-active', isActive);

    const video = slide.querySelector('video');
    if (video) {
      if (isActive) {
        video.play().catch(() => {});
      } else {
        video.pause();
      }
    }
  });

  if (heroDots.length) {
    heroDots.forEach((dot, i) => {
      dot.classList.toggle('active', i === heroCurrent);
    });
  }
}

function initHeroSlider() {
  if (!heroSlides.length) return;

  // –ø–µ—Ä–≤—ã–π —Å–ª–∞–π–¥
  setHeroSlide(0);

  // –ø–æ –∫–ª–∏–∫—É –Ω–∞ —Ç–æ—á–∫–∏
  if (heroDots.length) {
    heroDots.forEach((dot, i) => {
      dot.addEventListener('click', () => {
        setHeroSlide(i);
        if (heroTimer) clearInterval(heroTimer);
        heroTimer = setInterval(() => setHeroSlide(heroCurrent + 1), 7000);
      });
    });
  }

  // –∞–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫–∞
  heroTimer = setInterval(() => {
    setHeroSlide(heroCurrent + 1);
  }, 7000);
}
/* =============================
   HIDE SEARCH WHEN MODALS OPEN
   ============================= */

function hideSearchFab() {
  const fab = document.getElementById('search-fab');
  const panel = document.getElementById('search-panel');

  if (fab) fab.style.display = 'none';
  if (panel) {
    panel.classList.remove('open');
    panel.setAttribute('aria-hidden', 'true');
  }
}

function showSearchFab() {
  const fab = document.getElementById('search-fab');
  if (fab) fab.style.display = '';
}

/* --- –ö–æ–≥–¥–∞ –æ—Ç–∫—Ä—ã—Ç –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç --- */
if (userAreaBtn) {
  userAreaBtn.addEventListener('click', () => {
    hideSearchFab();
  });
}

/* --- –ö–æ–≥–¥–∞ –æ—Ç–∫—Ä—ã–≤–∞–µ–º –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ --- */
if (gotoCheckoutBtn) {
  gotoCheckoutBtn.addEventListener('click', () => {
    hideSearchFab();
  });
}

/* --- –ö–æ–≥–¥–∞ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è –ø–∞–Ω–µ–ª–∏ ‚Äî –≤–µ—Ä–Ω—É—Ç—å –ø–æ–∏—Å–∫ --- */
document.addEventListener('click', (e) => {
  if (e.target.id === "ai-close" ||
      e.target.id === "profile-close" ||
      e.target.id === "close-modal" ||
      e.target.id === "cart-close-btn") 
  {
    setTimeout(showSearchFab, 300);
  }
});
// ===================== BRAVO SUPER AI =====================

// –∫–Ω–æ–ø–∫–∏ –∏ —ç–ª–µ–º–µ–Ω—Ç—ã
const aiPanel = document.querySelector('.ai-panel');
const aiBtn = document.querySelector('.ai-btn');
const aiCloseBtn = document.querySelector('.ai-close');
const aiForm = document.querySelector('.ai-form');
const aiInput = aiForm ? aiForm.querySelector('input') : null;
const aiMsgList = document.querySelector('.ai-messages');
const aiScenarioBtns = document.querySelectorAll('[data-scenario]');

// –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
function aiAddMessage(text, from = "bot") {
  if (!aiMsgList) return;
  const div = document.createElement("div");
  div.className = "ai-msg " + (from === "user" ? "ai-msg-user" : "ai-msg-bot");
  div.textContent = text;
  aiMsgList.appendChild(div);
  aiMsgList.scrollTop = aiMsgList.scrollHeight;
}

// –≥–æ—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
const AI_SCENARIOS = {
  movie: {
    title: "–ù–∞–±–æ—Ä –∫ —Ñ–∏–ª—å–º—É",
    reply:
      "üé¨ –û—Ç–ª–∏—á–Ω—ã–π –≤—ã–±–æ—Ä! –ö —Ñ–∏–ª—å–º—É —á–∞—â–µ –≤—Å–µ–≥–æ –±–µ—Ä—É—Ç:\n\n" +
      "‚Ä¢ –≤–∏–Ω–æ–≥—Ä–∞–¥ –±–µ–∑ –∫–æ—Å—Ç–æ—á–µ–∫\n" +
      "‚Ä¢ —Å–ª–∞–¥–æ—Å—Ç–∏ (–≤–∞—Ñ–ª–∏, –ø–µ—á–µ–Ω—å–µ)\n" +
      "‚Ä¢ –Ω–∞–ø–∏—Ç–∫–∏ (–∫–æ–ª–∞, –ª–∏–º–æ–Ω–∞–¥—ã)\n" +
      "‚Ä¢ –ª—ë–≥–∫–∏–µ —Ñ—Ä—É–∫—Ç—ã (–±–∞–Ω–∞–Ω—ã, –≥—Ä—É—à–∏)\n\n" +
      "–•–æ—á–µ—à—å —Å–æ–±—Ä–∞—Ç—å –≥–æ—Ç–æ–≤—É—é –∫–æ—Ä–∑–∏–Ω—É? –ú–æ–≥—É –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç—ã!"
  },

  guests: {
    title: "–ö –ø—Ä–∏—Ö–æ–¥—É –≥–æ—Å—Ç–µ–π",
    reply:
      "ü•Ç –î–ª—è –≥–æ—Å—Ç–µ–π –ø–æ–¥–æ–π–¥—É—Ç:\n\n" +
      "‚Ä¢ —Ñ—Ä—É–∫—Ç–æ–≤—ã–µ –Ω–∞–±–æ—Ä—ã\n" +
      "‚Ä¢ –æ–≤–æ—â–∏ –ø–æ–¥ –Ω–∞—Ä–µ–∑–∫—É\n" +
      "‚Ä¢ —Å–ª–∞–¥–æ—Å—Ç–∏ –∫ —á–∞—é\n" +
      "‚Ä¢ —Å–æ–∫–∏ –∏ –ª–∏–º–æ–Ω–∞–¥—ã\n\n" +
      "–°–∫–æ–ª—å–∫–æ –±—É–¥–µ—Ç —á–µ–ª–æ–≤–µ–∫? –°–æ–±–µ—Ä—É –∏–¥–µ–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä üëå"
  },

  healthy: {
    title: "–ß—Ç–æ-–Ω–∏–±—É–¥—å –ø–æ–ª–µ–∑–Ω–æ–µ",
    reply:
      "ü•ó –î–ª—è –ø–æ–ª–µ–∑–Ω–æ–≥–æ —Ä–∞—Ü–∏–æ–Ω–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É—é:\n\n" +
      "‚Ä¢ —è–≥–æ–¥—ã, —Ü–∏—Ç—Ä—É—Å—ã, –∫–∏–≤–∏\n" +
      "‚Ä¢ –æ–≤–æ—â–∏ (–æ–≥—É—Ä—Ü—ã, –ø–æ–º–∏–¥–æ—Ä—ã, –∫–∞–ø—É—Å—Ç–∞)\n" +
      "‚Ä¢ –æ—Ä–µ—Ö–∏, —Å—É—Ö–æ—Ñ—Ä—É–∫—Ç—ã\n" +
      "‚Ä¢ —á–∞–π –∏–ª–∏ –≤–æ–¥—É\n\n" +
      "–ú–æ–≥—É –ø–æ–¥–æ–±—Ä–∞—Ç—å –ø—Ä–æ–¥—É–∫—Ç—ã –ø–æ–¥ –ö–ë–ñ–£ –∏–ª–∏ —Ü–µ–ª–∏: –ø–æ—Ö—É–¥–µ—Ç—å / –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –≤–µ—Å / —ç–Ω–µ—Ä–≥–µ—Ç–∏—á–Ω–æ—Å—Ç—å."
  },

  cheap: {
    title: "–°–∞–º–æ–µ –≤—ã–≥–æ–¥–Ω–æ–µ",
    reply:
      "üí∏ –õ–æ–≤–∏ –±—é–¥–∂–µ—Ç–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã!\n\n" +
      "‚Ä¢ —è–±–ª–æ–∫–∏\n" +
      "‚Ä¢ –¥—ã–Ω—è / –∞—Ä–±—É–∑\n" +
      "‚Ä¢ –æ–≤–æ—â–∏ –ø–æ –∞–∫—Ü–∏–∏\n" +
      "‚Ä¢ –º–∞–∫–∞—Ä–æ–Ω—ã, –∫—Ä—É–ø—ã\n\n" +
      "–°–∫–∞–∂–∏ –±—é–¥–∂–µ—Ç ‚Äî —Å–æ–±–µ—Ä—É –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –≤—ã–≥–æ–¥–Ω—É—é –∫–æ—Ä–∑–∏–Ω—É."
  }
};

// –æ—Ç–∫—Ä—ã—Ç—å –ò–ò
function openAiPanel(scenario = null) {
  aiPanel.setAttribute("aria-hidden", "false");
  aiMsgList.innerHTML = "";

  aiAddMessage("–ü—Ä–∏–≤–µ—Ç! –Ø Bravo –ò–ò üëã\n–ü–æ–º–æ–≥—É —Å–æ–±—Ä–∞—Ç—å –∑–∞–∫–∞–∑, –ø–æ–¥–æ–±—Ä–∞—Ç—å –ø—Ä–æ–¥—É–∫—Ç—ã –∏–ª–∏ —Å–æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É.");

  if (scenario && AI_SCENARIOS[scenario]) {
    aiAddMessage("‚ñ∂ " + AI_SCENARIOS[scenario].title, "user");
    aiAddMessage(AI_SCENARIOS[scenario].reply, "bot");
  }

  aiInput.value = "";
  aiInput.focus();
}

// –∑–∞–∫—Ä—ã—Ç—å –ò–ò
function closeAiPanel() {
  aiPanel.setAttribute("aria-hidden", "true");
}

// –∫–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ –ò–ò
if (aiBtn) {
  aiBtn.addEventListener("click", () => openAiPanel());
}

// –∑–∞–∫—Ä—ã—Ç–∏–µ –∫—Ä–µ—Å—Ç–∏–∫–æ–º
if (aiCloseBtn) {
  aiCloseBtn.addEventListener("click", () => closeAiPanel());
}

// –±—ã—Å—Ç—Ä—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ (–∫–Ω–æ–ø–∫–∏)

aiScenarioBtns.forEach(btn => {
  btn.addEventListener('click', () => {
    const scenario = btn.dataset.scenario;
    const conf = AI_SCENARIOS[scenario];
    if (!conf) return;

    aiAddMessage(conf.title, 'user');
    aiAddMessage(conf.reply, 'bot');
  });
});

// –ø–æ–Ω–∏–º–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞
function aiUnderstand(text) {
  const q = text.toLowerCase();

  if (q.includes("—Ñ–∏–ª—å–º")) return AI_SCENARIOS.movie.reply;
  if (q.includes("–≥–æ—Å—Ç") || q.includes("–≤–µ—á–µ—Ä–∏–Ω")) return AI_SCENARIOS.guests.reply;
  if (q.includes("–ø–ø") || q.includes("–∫–±–∂—É") || q.includes("–¥–∏–µ—Ç")) return AI_SCENARIOS.healthy.reply;
  if (q.includes("–¥–µ—à–µ–≤") || q.includes("–≤—ã–≥–æ–¥")) return AI_SCENARIOS.cheap.reply;

  return "–ü–æ–Ω—è–ª —Ç–µ–±—è! –†–∞—Å—Å–∫–∞–∂–∏ –ø–æ–¥—Ä–æ–±–Ω–µ–µ: –∫ —Ñ–∏–ª—å–º—É, –∫ –≥–æ—Å—Ç—è–º, –Ω–∞ –∑–∞–≤—Ç—Ä–∞–∫ –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –ø–æ–¥–æ–±—Ä–∞—Ç—å –≤–∫—É—Å–Ω–æ–µ? üòä";
}

// –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞
if (aiForm && aiInput) {
  aiForm.addEventListener("submit", (e) => {
    e.preventDefault();

    const text = aiInput.value.trim();
    if (!text) return;

    aiAddMessage(text, "user");

    const answer = aiUnderstand(text);
    aiAddMessage(answer, "bot");

    aiInput.value = "";
  });
}

/* ========== init ========== */
function init() {
  tryTelegramLogin();
  updateUserUI();

  initHeroSlider();

  visibleProducts = products.slice();
  renderCatalog(visibleProducts);
  renderCart();

  hideFloatingCart();

  if (tg && typeof tg.expand === 'function') {
    tg.expand();
  }
}
init();

